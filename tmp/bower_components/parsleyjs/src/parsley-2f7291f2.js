define(["parsley/utils","parsley/defaults","parsley/abstract","parsley/validator","parsley/ui","parsley/factory/options","parsley/form","parsley/field","parsley/multiple","parsley/pubsub","i18n/en"],function(e,t,n,i,r,o,s,a,l){var u=function(t,n,i){if(this.__class__="Parsley",this.__version__="@@version",this.__id__=e.hash(4),"undefined"==typeof t)throw new Error("You must give an element");if("undefined"!=typeof i&&"ParsleyForm"!==i.__class__)throw new Error("Parent instance must be a ParsleyForm instance");return this.init($(t),n,i)};return u.prototype={init:function(n,i,r){if(!n.length)throw new Error("You must bind Parsley on an existing element.");if(this.$element=n,this.$element.data("Parsley")){var s=this.$element.data("Parsley");return"undefined"!=typeof r&&(s.parent=r),s}return this.OptionsFactory=new o(t,e.get(window,"ParsleyConfig")||{},i,this.getNamespace(i)),this.options=this.OptionsFactory.get(this),this.$element.is("form")||e.attr(this.$element,this.options.namespace,"validate")&&!this.$element.is(this.options.inputs)?this.bind("parsleyForm"):this.$element.is(this.options.inputs)&&!this.$element.is(this.options.excluded)?this.isMultiple()?this.handleMultiple(r):this.bind("parsleyField",r):this},isMultiple:function(){return this.$element.is("input[type=radio], input[type=checkbox]")&&"undefined"==typeof this.options.multiple||this.$element.is("select")&&"undefined"!=typeof this.$element.attr("multiple")},handleMultiple:function(t){var n,i,r,o=this;if(this.options=$.extend(this.options,t?t.OptionsFactory.get(t):{},e.attr(this.$element,this.options.namespace)),this.options.multiple?i=this.options.multiple:"undefined"!=typeof this.$element.attr("name")&&this.$element.attr("name").length?i=n=this.$element.attr("name"):"undefined"!=typeof this.$element.attr("id")&&this.$element.attr("id").length&&(i=this.$element.attr("id")),this.$element.is("select")&&"undefined"!=typeof this.$element.attr("multiple"))return this.bind("parsleyFieldMultiple",t,i||this.__id__);if("undefined"==typeof i)return window.console&&window.console.warn&&window.console.warn("To be binded by Parsley, a radio, a checkbox and a multiple select input must have either a name or a multiple option.",this.$element),this;if(i=i.replace(/(:|\.|\[|\]|\{|\}|\$)/g,""),"undefined"!=typeof n&&$('input[name="'+n+'"]').each(function(){$(this).is("input[type=radio], input[type=checkbox]")&&$(this).attr(o.options.namespace+"multiple",i)}),$("["+this.options.namespace+"multiple="+i+"]").length)for(var s=0;s<$("["+this.options.namespace+"multiple="+i+"]").length;s++)if("undefined"!=typeof $($("["+this.options.namespace+"multiple="+i+"]").get(s)).data("Parsley")){r=$($("["+this.options.namespace+"multiple="+i+"]").get(s)).data("Parsley"),this.$element.data("ParsleyFieldMultiple")||(r.addElement(this.$element),this.$element.attr(this.options.namespace+"id",r.__id__));break}return this.bind("parsleyField",t,i,!0),r||this.bind("parsleyFieldMultiple",t,i)},getNamespace:function(n){return"undefined"!=typeof this.$element.data("parsleyNamespace")?this.$element.data("parsleyNamespace"):"undefined"!=typeof e.get(n,"namespace")?n.namespace:"undefined"!=typeof e.get(window,"ParsleyConfig.namespace")?window.ParsleyConfig.namespace:t.namespace},bind:function(t,i,r,o){var u;switch(t){case"parsleyForm":u=$.extend(new s(this.$element,this.OptionsFactory),new n,window.ParsleyExtend)._bindFields();break;case"parsleyField":u=$.extend(new a(this.$element,this.OptionsFactory,i),new n,window.ParsleyExtend);break;case"parsleyFieldMultiple":u=$.extend(new a(this.$element,this.OptionsFactory,i),new n,new l,window.ParsleyExtend)._init(r);break;default:throw new Error(t+"is not a supported Parsley type")}return"undefined"!=typeof r&&e.setAttr(this.$element,this.options.namespace,"multiple",r),"undefined"!=typeof o?(this.$element.data("ParsleyFieldMultiple",u),u):(new RegExp("ParsleyF","i").test(u.__class__)&&(this.$element.data("Parsley",u),$.emit("parsley:"+("parsleyForm"===t?"form":"field")+":init",u)),u)}},$.fn.parsley=$.fn.psly=function(e){if(this.length>1){var t=[];return this.each(function(){t.push($(this).parsley(e))}),t}return $(this).length?new u(this,e):void(window.console&&window.console.warn&&window.console.warn("You must bind Parsley on an existing element."))},window.ParsleyUI="function"==typeof e.get(window,"ParsleyConfig.ParsleyUI")?(new window.ParsleyConfig.ParsleyUI).listen():(new r).listen(),"undefined"==typeof window.ParsleyExtend&&(window.ParsleyExtend={}),"undefined"==typeof window.ParsleyConfig&&(window.ParsleyConfig={}),window.Parsley=window.psly=u,window.ParsleyUtils=e,window.ParsleyValidator=new i(window.ParsleyConfig.validators,window.ParsleyConfig.i18n),!1!==e.get(window,"ParsleyConfig.autoBind")&&$(function(){$("[data-parsley-validate]").length&&$("[data-parsley-validate]").parsley()}),u});