define("parsley/field",["parsley/factory/constraint","parsley/ui","parsley/utils"],function(e,t,n){var i=function(e,t,i){this.__class__="ParsleyField",this.__id__=n.hash(4),this.$element=$(e),"undefined"!=typeof i?(this.parent=i,this.OptionsFactory=this.parent.OptionsFactory,this.options=this.OptionsFactory.get(this)):(this.OptionsFactory=t,this.options=this.OptionsFactory.get(this)),this.constraints=[],this.constraintsByName={},this.validationResult=[],this._bindConstraints()};return i.prototype={validate:function(e){return this.value=this.getValue(),$.emit("parsley:field:validate",this),$.emit("parsley:field:"+(this.isValid(e,this.value)?"success":"error"),this),$.emit("parsley:field:validated",this),this.validationResult},isValid:function(e,t){this.refreshConstraints();var n=this._getConstraintsSortedPriorities();if(0===n.length)return this.validationResult=[];if(("undefined"==typeof t||null===t)&&(t=this.getValue()),!t.length&&!this._isRequired()&&"undefined"==typeof this.options.validateIfEmpty&&!0!==e)return this.validationResult=[];if(!1===this.options.priorityEnabled)return!0===(this.validationResult=this.validateThroughValidator(t,this.constraints,"Any"));for(var i=0;i<n.length;i++)if(!0!==(this.validationResult=this.validateThroughValidator(t,this.constraints,n[i])))return!1;return!0},getValue:function(){var e;return e="undefined"!=typeof this.options.value?this.options.value:this.$element.val(),"undefined"==typeof e||null===e?"":!0===this.options.trimValue?e.replace(/^\s+|\s+$/g,""):e},refreshConstraints:function(){return this.actualizeOptions()._bindConstraints()},addConstraint:function(t,n,i,r){if(t=t.toLowerCase(),"function"==typeof window.ParsleyValidator.validators[t]){var o=new e(this,t,n,i,r);"undefined"!==this.constraintsByName[o.name]&&this.removeConstraint(o.name),this.constraints.push(o),this.constraintsByName[o.name]=o}return this},removeConstraint:function(e){for(var t=0;t<this.constraints.length;t++)if(e===this.constraints[t].name){this.constraints.splice(t,1);break}return delete this.constraintsByName[e],this},updateConstraint:function(e,t,n){return this.removeConstraint(e).addConstraint(e,t,n)},_bindConstraints:function(){for(var e=[],t={},n=0;n<this.constraints.length;n++)!1===this.constraints[n].isDomConstraint&&(e.push(this.constraints[n]),t[this.constraints[n].name]=this.constraints[n]);this.constraints=e,this.constraintsByName=t;for(var i in this.options)this.addConstraint(i,this.options[i]);return this._bindHtml5Constraints()},_bindHtml5Constraints:function(){(this.$element.hasClass("required")||this.$element.attr("required"))&&this.addConstraint("required",!0,void 0,!0),"string"==typeof this.$element.attr("pattern")&&this.addConstraint("pattern",this.$element.attr("pattern"),void 0,!0),"undefined"!=typeof this.$element.attr("min")&&"undefined"!=typeof this.$element.attr("max")?this.addConstraint("range",[this.$element.attr("min"),this.$element.attr("max")],void 0,!0):"undefined"!=typeof this.$element.attr("min")?this.addConstraint("min",this.$element.attr("min"),void 0,!0):"undefined"!=typeof this.$element.attr("max")&&this.addConstraint("max",this.$element.attr("max"),void 0,!0),"undefined"!=typeof this.$element.attr("minlength")&&"undefined"!=typeof this.$element.attr("maxlength")?this.addConstraint("length",[this.$element.attr("minlength"),this.$element.attr("maxlength")],void 0,!0):"undefined"!=typeof this.$element.attr("minlength")?this.addConstraint("minlength",this.$element.attr("minlength"),void 0,!0):"undefined"!=typeof this.$element.attr("maxlength")&&this.addConstraint("maxlength",this.$element.attr("maxlength"),void 0,!0);var e=this.$element.attr("type");return"undefined"==typeof e?this:"number"===e?"undefined"==typeof this.$element.attr("step")||0===parseFloat(this.$element.attr("step"))%1?this.addConstraint("type","integer",void 0,!0):this.addConstraint("type","number",void 0,!0):new RegExp(e,"i").test("email url range")?this.addConstraint("type",e,void 0,!0):this},_isRequired:function(){return"undefined"==typeof this.constraintsByName.required?!1:!1!==this.constraintsByName.required.requirements},_getConstraintsSortedPriorities:function(){for(var e=[],t=0;t<this.constraints.length;t++)-1===e.indexOf(this.constraints[t].priority)&&e.push(this.constraints[t].priority);return e.sort(function(e,t){return t-e}),e}},i});