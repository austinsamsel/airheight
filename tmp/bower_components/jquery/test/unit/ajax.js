if(module("ajax",{teardown:moduleTeardown}),jQuery.ajax&&(!isLocal||hasPHP)){var isOpera=!!window.opera;test("jQuery.ajax() - success callbacks",function(){expect(8),jQuery.ajaxSetup({timeout:0}),stop(),jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop"),start()}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")}).ajaxError(function(){ok(!1,"ajaxError")}).ajaxSuccess(function(){ok(!0,"ajaxSuccess")}),jQuery.ajax({url:url("data/name.html"),beforeSend:function(){ok(!0,"beforeSend")},success:function(){ok(!0,"success")},error:function(){ok(!1,"error")},complete:function(){ok(!0,"complete")}})}),test("jQuery.ajax() - success callbacks - (url, options) syntax",function(){expect(8),jQuery.ajaxSetup({timeout:0}),stop(),setTimeout(function(){jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop"),start()}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")}).ajaxError(function(){ok(!1,"ajaxError")}).ajaxSuccess(function(){ok(!0,"ajaxSuccess")}),jQuery.ajax(url("data/name.html"),{beforeSend:function(){ok(!0,"beforeSend")},success:function(){ok(!0,"success")},error:function(){ok(!1,"error")},complete:function(){ok(!0,"complete")}})},13)}),test("jQuery.ajax() - success callbacks (late binding)",function(){expect(8),jQuery.ajaxSetup({timeout:0}),stop(),setTimeout(function(){jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop"),start()}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")}).ajaxError(function(){ok(!1,"ajaxError")}).ajaxSuccess(function(){ok(!0,"ajaxSuccess")}),jQuery.ajax({url:url("data/name.html"),beforeSend:function(){ok(!0,"beforeSend")}}).complete(function(){ok(!0,"complete")}).success(function(){ok(!0,"success")}).error(function(){ok(!1,"error")})},13)}),test("jQuery.ajax() - success callbacks (oncomplete binding)",function(){expect(8),jQuery.ajaxSetup({timeout:0}),stop(),setTimeout(function(){jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop")}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")}).ajaxError(function(){ok(!1,"ajaxError")}).ajaxSuccess(function(){ok(!0,"ajaxSuccess")}),jQuery.ajax({url:url("data/name.html"),beforeSend:function(){ok(!0,"beforeSend")},complete:function(e){e.complete(function(){ok(!0,"complete")}).success(function(){ok(!0,"success")}).error(function(){ok(!1,"error")}).complete(function(){start()})}})},13)}),test("jQuery.ajax() - success callbacks (very late binding)",function(){expect(8),jQuery.ajaxSetup({timeout:0}),stop(),setTimeout(function(){jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop")}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")}).ajaxError(function(){ok(!1,"ajaxError")}).ajaxSuccess(function(){ok(!0,"ajaxSuccess")}),jQuery.ajax({url:url("data/name.html"),beforeSend:function(){ok(!0,"beforeSend")},complete:function(e){setTimeout(function(){e.complete(function(){ok(!0,"complete")}).success(function(){ok(!0,"success")}).error(function(){ok(!1,"error")}).complete(function(){start()})},100)}})},13)}),test("jQuery.ajax() - success callbacks (order)",function(){expect(1),jQuery.ajaxSetup({timeout:0}),stop();var e="";setTimeout(function(){jQuery.ajax({url:url("data/name.html"),success:function(t,a,o){o.success(function(){o.success(function(){e+="E"}),e+="D"}),e+="A"},complete:function(){strictEqual(e,"ABCDE","Proper order"),start()}}).success(function(){e+="B"}).success(function(){e+="C"})},13)}),test("jQuery.ajax() - error callbacks",function(){expect(8),stop(),jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop"),start()}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")}).ajaxError(function(){ok(!0,"ajaxError")}).ajaxSuccess(function(){ok(!1,"ajaxSuccess")}),jQuery.ajaxSetup({timeout:500}),jQuery.ajax({url:url("data/name.php?wait=5"),beforeSend:function(){ok(!0,"beforeSend")},success:function(){ok(!1,"success")},error:function(){ok(!0,"error")},complete:function(){ok(!0,"complete")}})}),test("jQuery.ajax - multiple method signatures introduced in 1.5 ( #8107)",function(){expect(4),stop(),jQuery.when(jQuery.ajax().success(function(){ok(!0,"With no arguments")}),jQuery.ajax("data/name.html").success(function(){ok(!0,"With only string URL argument")}),jQuery.ajax("data/name.html",{}).success(function(){ok(!0,"With string URL param and map")}),jQuery.ajax({url:"data/name.html"}).success(function(){ok(!0,"With only map")})).always(function(){start()})}),test("jQuery.ajax() - textStatus and errorThrown values",function(){function e(){--t||start()}var t=2;expect(2*t),stop(),jQuery.ajax({url:url("data/name.php?wait=5"),error:function(t,a,o){strictEqual(a,"abort","textStatus is 'abort' for abort"),strictEqual(o,"abort","errorThrown is 'abort' for abort"),e()}}).abort(),jQuery.ajax({url:url("data/name.php?wait=5"),error:function(t,a,o){strictEqual(a,"mystatus","textStatus is 'mystatus' for abort('mystatus')"),strictEqual(o,"mystatus","errorThrown is 'mystatus' for abort('mystatus')"),e()}}).abort("mystatus")}),test("jQuery.ajax() - responseText on error",function(){expect(1),stop(),jQuery.ajax({url:url("data/errorWithText.php"),error:function(e){strictEqual(e.responseText,"plain text message","Test jqXHR.responseText is filled for HTTP errors")},complete:function(){start()}})}),test(".ajax() - retry with jQuery.ajax( this )",function(){expect(2),stop();var e,t=!0;jQuery.ajax({url:url("data/errorWithText.php"),error:function(){t?(t=!1,jQuery.ajax(this)):(ok(!0,"Test retrying with jQuery.ajax(this) works"),jQuery.ajax({url:url("data/errorWithText.php"),data:{x:1},beforeSend:function(){return e?(strictEqual(this.url,e,"url parameters are not re-appended"),start(),!1):void(e=this.url)},error:function(){jQuery.ajax(this)}}))}})}),test(".ajax() - headers",function(){expect(4),stop(),jQuery("#foo").ajaxSend(function(e,t){t.setRequestHeader("ajax-send","test")});var e,t={siMPle:"value","SometHing-elsE":"other value",OthEr:"something else"},a=[];for(e in t)a.push(e);a.push("ajax-send"),jQuery.ajax(url("data/headers.php?keys="+a.join("_")),{headers:t,success:function(e,a,o){var r,n,s=[];for(r in t)s.push(r,": ",t[r],"\n");s.push("ajax-send: test\n"),s=s.join(""),strictEqual(e,s,"Headers were sent"),strictEqual(o.getResponseHeader("Sample-Header"),"Hello World","Sample header received"),n=o.getResponseHeader("Empty-Header"),null===n?ok(!0,"Firefox doesn't support empty headers"):strictEqual(n,"","Empty header received"),strictEqual(o.getResponseHeader("Sample-Header2"),"Hello World 2","Second sample header received")},error:function(){ok(!1,"error")}}).always(function(){start()})}),test(".ajax() - Accept header",function(){expect(1),stop(),jQuery.ajax(url("data/headers.php?keys=accept"),{headers:{Accept:"very wrong accept value"},beforeSend:function(e){e.setRequestHeader("Accept","*/*")},success:function(e){strictEqual(e,"accept: */*\n","Test Accept header is set to last value provided"),start()},error:function(){ok(!1,"error")}})}),test(".ajax() - contentType",function(){function e(){--t||start()}expect(2),stop();var t=2;jQuery.ajax(url("data/headers.php?keys=content-type"),{contentType:"test",success:function(e){strictEqual(e,"content-type: test\n","Test content-type is sent when options.contentType is set")},complete:function(){e()}}),jQuery.ajax(url("data/headers.php?keys=content-type"),{contentType:!1,success:function(e){strictEqual(e,"content-type: \n","Test content-type is not sent when options.contentType===false")},complete:function(){e()}})}),test(".ajax() - protocol-less urls",function(){expect(1),jQuery.ajax({url:"//somedomain.com",beforeSend:function(e,t){return equal(t.url,location.protocol+"//somedomain.com","Make sure that the protocol is added."),!1}})}),test(".ajax() - hash",function(){expect(3),jQuery.ajax({url:"data/name.html#foo",beforeSend:function(e,t){return equal(t.url,"data/name.html","Make sure that the URL is trimmed."),!1}}),jQuery.ajax({url:"data/name.html?abc#foo",beforeSend:function(e,t){return equal(t.url,"data/name.html?abc","Make sure that the URL is trimmed."),!1}}),jQuery.ajax({url:"data/name.html?abc#foo",data:{test:123},beforeSend:function(e,t){return equal(t.url,"data/name.html?abc&test=123","Make sure that the URL is trimmed."),!1}})}),test("jQuery ajax - cross-domain detection",function(){expect(7);var e=document.location,t=e.port||("http:"===e.protocol?80:443),a=666===e.port?667:666,o="http:"===e.protocol?"https:":"http:";jQuery.ajax({dataType:"jsonp",url:e.protocol+"//"+e.host+":"+t,beforeSend:function(e,t){return ok(!t.crossDomain,"Test matching ports are not detected as cross-domain"),!1}}),jQuery.ajax({dataType:"jsonp",url:o+"//"+e.host,beforeSend:function(e,t){return ok(t.crossDomain,"Test different protocols are detected as cross-domain"),!1}}),jQuery.ajax({dataType:"jsonp",url:"app:/path",beforeSend:function(e,t){return ok(t.crossDomain,"Adobe AIR app:/ URL detected as cross-domain"),!1}}),jQuery.ajax({dataType:"jsonp",url:e.protocol+"//somewebsitethatdoesnotexist-656329477541.com:"+(e.port||80),beforeSend:function(e,t){return ok(t.crossDomain,"Test different hostnames are detected as cross-domain"),!1}}),jQuery.ajax({dataType:"jsonp",url:e.protocol+"//"+e.hostname+":"+a,beforeSend:function(e,t){return ok(t.crossDomain,"Test different ports are detected as cross-domain"),!1}}),jQuery.ajax({dataType:"jsonp",url:"about:blank",beforeSend:function(e,t){return ok(t.crossDomain,"Test about:blank is detected as cross-domain"),!1}}),jQuery.ajax({dataType:"jsonp",url:e.protocol+"//"+e.host,crossDomain:!0,beforeSend:function(e,t){return ok(t.crossDomain,"Test forced crossDomain is detected as cross-domain"),!1}})}),test(".load() - 404 error callbacks",function(){expect(6),stop(),jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop"),start()}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")}).ajaxError(function(){ok(!0,"ajaxError")}).ajaxSuccess(function(){ok(!1,"ajaxSuccess")}),jQuery("<div/>").load("data/404.html",function(){ok(!0,"complete")})}),test("jQuery.ajax() - abort",function(){expect(8),stop(),jQuery("#foo").ajaxStart(function(){ok(!0,"ajaxStart")}).ajaxStop(function(){ok(!0,"ajaxStop"),start()}).ajaxSend(function(){ok(!0,"ajaxSend")}).ajaxComplete(function(){ok(!0,"ajaxComplete")});var e=jQuery.ajax({url:url("data/name.php?wait=5"),beforeSend:function(){ok(!0,"beforeSend")},complete:function(){ok(!0,"complete")}});equal(e.readyState,1,"XHR readyState indicates successful dispatch"),e.abort(),equal(e.readyState,0,"XHR readyState indicates successful abortion")}),test("Ajax events with context",function(){function e(e){equal(this,o,e.type)}function t(e){return function(){equal(this,o,"context is preserved on callback "+e)}}function a(e){return function(){equal(typeof this.url,"string","context is settings on callback "+e)}}expect(14),stop();var o=document.createElement("div");jQuery("#foo").add(o).ajaxSend(e).ajaxComplete(e).ajaxError(e).ajaxSuccess(e),jQuery.ajax({url:url("data/name.html"),beforeSend:t("beforeSend"),success:t("success"),error:t("error"),complete:function(){t("complete").call(this),jQuery.ajax({url:url("data/404.html"),context:o,beforeSend:t("beforeSend"),error:t("error"),complete:function(){t("complete").call(this),jQuery("#foo").add(o).unbind(),jQuery.ajax({url:url("data/404.html"),beforeSend:a("beforeSend"),error:a("error"),complete:function(){a("complete").call(this),start()}})}})},context:o})}),test("jQuery.ajax context modification",function(){expect(1),stop();var e={};jQuery.ajax({url:url("data/name.html"),context:e,beforeSend:function(){this.test="foo"},complete:function(){start()}}),equal(e.test,"foo","Make sure the original object is maintained.")}),test("jQuery.ajax context modification through ajaxSetup",function(){expect(4),stop();var e={};jQuery.ajaxSetup({context:e}),strictEqual(jQuery.ajaxSettings.context,e,"Make sure the context is properly set in ajaxSettings."),jQuery.ajax({url:url("data/name.html"),complete:function(){strictEqual(this,e,"Make sure the original object is maintained."),jQuery.ajax({url:url("data/name.html"),context:{},complete:function(){ok(this!==e,"Make sure overidding context is possible."),jQuery.ajaxSetup({context:!1}),jQuery.ajax({url:url("data/name.html"),beforeSend:function(){this.test="foo2"},complete:function(){ok(this!==e,"Make sure unsetting context is possible."),start()}})}})}})}),test("jQuery.ajax() - disabled globals",function(){expect(3),stop(),jQuery("#foo").ajaxStart(function(){ok(!1,"ajaxStart")}).ajaxStop(function(){ok(!1,"ajaxStop")}).ajaxSend(function(){ok(!1,"ajaxSend")}).ajaxComplete(function(){ok(!1,"ajaxComplete")}).ajaxError(function(){ok(!1,"ajaxError")}).ajaxSuccess(function(){ok(!1,"ajaxSuccess")}),jQuery.ajax({global:!1,url:url("data/name.html"),beforeSend:function(){ok(!0,"beforeSend")},success:function(){ok(!0,"success")},error:function(){ok(!1,"error")},complete:function(){ok(!0,"complete"),setTimeout(function(){start()},13)}})}),test("jQuery.ajax - xml: non-namespace elements inside namespaced elements",function(){expect(3),stop(),jQuery.ajax({url:url("data/with_fries.xml"),dataType:"xml",success:function(e){equal(jQuery("properties",e).length,1,"properties in responseXML"),equal(jQuery("jsconf",e).length,1,"jsconf in responseXML"),equal(jQuery("thing",e).length,2,"things in responseXML"),start()}})}),test("jQuery.ajax - xml: non-namespace elements inside namespaced elements (over JSONP)",function(){expect(3),stop(),jQuery.ajax({url:url("data/with_fries_over_jsonp.php"),dataType:"jsonp xml",success:function(e){equal(jQuery("properties",e).length,1,"properties in responseXML"),equal(jQuery("jsconf",e).length,1,"jsconf in responseXML"),equal(jQuery("thing",e).length,2,"things in responseXML"),start()},error:function(e,t,a){ok(!1,a),start()}})}),test("jQuery.ajax - HEAD requests",function(){expect(2),stop(),jQuery.ajax({url:url("data/name.html"),type:"HEAD",success:function(e,t,a){var o=a.getAllResponseHeaders();ok(/Date/i.test(o),"No Date in HEAD response"),jQuery.ajax({url:url("data/name.html"),data:{whip_it:"good"},type:"HEAD",success:function(e,t,a){var o=a.getAllResponseHeaders();ok(/Date/i.test(o),"No Date in HEAD response with data"),start()}})}})}),test("jQuery.ajax - beforeSend",function(){expect(1),stop();var e=!1;jQuery.ajaxSetup({timeout:0}),jQuery.ajax({url:url("data/name.html"),beforeSend:function(){e=!0},success:function(){ok(e,"check beforeSend was executed"),start()}})}),test("jQuery.ajax - beforeSend, cancel request (#2688)",function(){expect(2),jQuery.ajax({url:url("data/name.html"),beforeSend:function(){return ok(!0,"beforeSend got called, canceling"),!1},success:function(){ok(!1,"request didn't get canceled")},complete:function(){ok(!1,"request didn't get canceled")},error:function(){ok(!1,"request didn't get canceled")}}).fail(function(e,t){strictEqual(t,"canceled","canceled request must fail with 'canceled' status text")})}),test("jQuery.ajax - beforeSend, cancel request manually",function(){expect(2),jQuery.ajax({url:url("data/name.html"),beforeSend:function(e){ok(!0,"beforeSend got called, canceling"),e.abort()},success:function(){ok(!1,"request didn't get canceled")},complete:function(){ok(!1,"request didn't get canceled")},error:function(){ok(!1,"request didn't get canceled")}}).fail(function(e,t){strictEqual(t,"canceled","manually canceled request must fail with 'canceled' status text")})}),window.foobar=null,window.testFoo=void 0,test("jQuery.ajax - dataType html",function(){expect(5),stop();var e=function(){equal(window.testFoo,"foo","Check if script was evaluated for datatype html"),equal(window.foobar,"bar","Check if script src was evaluated for datatype html"),start()};jQuery.ajax({dataType:"html",url:url("data/test.html"),success:function(t){jQuery("#ap").html(t),ok(t.match(/^html text/),"Check content for datatype html"),setTimeout(e,600)}})}),test("synchronous request",function(){expect(1);var e=jQuery.ajax({url:url("data/json_obj.js"),dataType:"text",async:!1}).responseText;ok(/^\{ "data"/.test(e),"check returned text")}),test("synchronous request with callbacks",function(){expect(2);var e;jQuery.ajax({url:url("data/json_obj.js"),async:!1,dataType:"text",success:function(t){ok(!0,"sucess callback executed"),e=t}}),ok(/^\{ "data"/.test(e),"check returned text")}),test("pass-through request object",function(){expect(8),stop();var e="data/name.html",t=0,a=0,o="",r=function(){t++};jQuery("#foo").ajaxError(function(e,t){a++,o+=": "+t.status}),jQuery("#foo").one("ajaxStop",function(){equal(t,5,"Check all ajax calls successful"),equal(a,0,"Check no ajax errors (status"+o+")"),jQuery("#foo").unbind("ajaxError"),start()}),ok(jQuery.get(url(e),r),"get"),ok(jQuery.post(url(e),r),"post"),ok(jQuery.getScript(url("data/test.js"),r),"script"),ok(jQuery.getJSON(url("data/json_obj.js"),r),"json"),ok(jQuery.ajax({url:url(e),success:r}),"generic")}),test("ajax cache",function(){expect(18),stop();var e=0;jQuery("#firstp").bind("ajaxSuccess",function(t,a,o){for(var r=/_=(.*?)(&|$)/g,n=null,s=0;6>s;s++){var u=r.exec(o.url);if(!u)break;n=u[1]}equal(s,1,"Test to make sure only one 'no-cache' parameter is there"),ok("tobereplaced555"!=n,"Test to be sure parameter (if it was there) was replaced"),6==++e&&start()}),ok(jQuery.ajax({url:"data/text.php",cache:!1}),"test with no parameters"),ok(jQuery.ajax({url:"data/text.php?pizza=true",cache:!1}),"test with 1 parameter"),ok(jQuery.ajax({url:"data/text.php?_=tobereplaced555",cache:!1}),"test with _= parameter"),ok(jQuery.ajax({url:"data/text.php?pizza=true&_=tobereplaced555",cache:!1}),"test with 1 parameter plus _= one"),ok(jQuery.ajax({url:"data/text.php?_=tobereplaced555&tv=false",cache:!1}),"test with 1 parameter plus _= one before it"),ok(jQuery.ajax({url:"data/text.php?name=David&_=tobereplaced555&washere=true",cache:!1}),"test with 2 parameters surrounding _= one")}),test("load(String)",function(){expect(2),stop(),jQuery.ajaxSetup({beforeSend:function(){strictEqual(this.type,"GET","no data means GET request")}}),jQuery("#first").load("data/name.html",function(){start()}),jQuery.ajaxSetup({beforeSend:null})}),test("load(String,null)",function(){expect(2),stop(),jQuery.ajaxSetup({beforeSend:function(){strictEqual(this.type,"GET","no data means GET request")}}),jQuery("#first").load("data/name.html",null,function(){start()})}),test("load(String,undefined)",function(){expect(2),stop(),jQuery.ajaxSetup({beforeSend:function(){strictEqual(this.type,"GET","no data means GET request")}}),jQuery("#first").load("data/name.html",void 0,function(){start()})}),test("load('url selector')",function(){expect(1),stop(),jQuery("#first").load("data/test3.html div.user",function(){equal(jQuery(this).children("div").length,2,"Verify that specific elements were injected"),start()})}),test("load(String, Function) with ajaxSetup on dataType json, see #2046",function(){expect(1),stop(),jQuery.ajaxSetup({dataType:"json"}),jQuery("#first").ajaxComplete(function(e,t,a){equal(a.dataType,"html","Verify the load() dataType was html"),jQuery("#first").unbind("ajaxComplete"),jQuery.ajaxSetup({dataType:""}),start()}),jQuery("#first").load("data/test3.html")}),test("load(String, Function) - simple: inject text into DOM",function(){expect(2),stop(),jQuery("#first").load(url("data/name.html"),function(){ok(/^ERROR/.test(jQuery("#first").text()),"Check if content was injected into the DOM"),start()})}),test("load(String, Function) - check scripts",function(){expect(7),stop();var e=function(){equal(window.foobar,"bar","Check if script src was evaluated after load"),equal(jQuery("#ap").html(),"bar","Check if script evaluation has modified DOM"),start()};jQuery("#first").load(url("data/test.html"),function(){ok(jQuery("#first").html().match(/^html text/),"Check content after loading html"),equal(jQuery("#foo").html(),"foo","Check if script evaluation has modified DOM"),equal(window.testFoo,"foo","Check if script was evaluated after load"),setTimeout(e,600)})}),test("load(String, Function) - check file with only a script tag",function(){expect(3),stop(),jQuery("#first").load(url("data/test2.html"),function(){equal(jQuery("#foo").html(),"foo","Check if script evaluation has modified DOM"),equal(window.testFoo,"foo","Check if script was evaluated after load"),start()})}),test("load(String, Function) - dataFilter in ajaxSettings",function(){expect(2),stop(),jQuery.ajaxSetup({dataFilter:function(){return"Hello World"}});var e=jQuery("<div/>").load(url("data/name.html"),function(t){strictEqual(e.html(),"Hello World","Test div was filled with filtered data"),strictEqual(t,"Hello World","Test callback receives filtered data"),jQuery.ajaxSetup({dataFilter:0}),start()})}),test("load(String, Object, Function)",function(){expect(2),stop(),jQuery("<div />").load(url("data/params_html.php"),{foo:3,bar:"ok"},function(){var e=jQuery(this).find("#post");equal(e.find("#foo").text(),"3","Check if a hash of data is passed correctly"),equal(e.find("#bar").text(),"ok","Check if a hash of data is passed correctly"),start()})}),test("load(String, String, Function)",function(){expect(2),stop(),jQuery("<div />").load(url("data/params_html.php"),"foo=3&bar=ok",function(){var e=jQuery(this).find("#get");equal(e.find("#foo").text(),"3","Check if a string of data is passed correctly"),equal(e.find("#bar").text(),"ok","Check if a	 of data is passed correctly"),start()})}),asyncTest("load() - data specified in ajaxSettings is merged in (#10524)",1,function(){jQuery.ajaxSetup({data:{foo:"bar"}});var e={baz:1};jQuery("#foo").load("data/echoQuery.php",e).ajaxComplete(function(e,t,a){ok(~a.data.indexOf("foo=bar"),"Data from ajaxSettings was used"),jQuery.ajaxSetup({data:null}),start()})}),asyncTest("load() - callbacks get the correct parameters",8,function(){var e=([].slice,{});jQuery.ajaxSetup({success:function(t,a,o){e[this.url]=[o.responseText,a,o]},error:function(t,a){e[this.url]=[t.responseText,a,t]}}),jQuery.when.apply(jQuery,jQuery.map([{type:"success",url:"data/echoQuery.php?arg=pop"},{type:"error",url:"data/404.php"}],function(t){return jQuery.Deferred(function(a){jQuery("#foo").load(t.url,function(){var o=arguments;strictEqual(e[t.url].length,o.length,"same number of arguments ("+t.type+")"),jQuery.each(e[t.url],function(e,a){strictEqual(o[e],a,"argument #"+e+" is the same ("+t.type+")")}),a.resolve()})})})).always(function(){jQuery.ajaxSetup({success:null,error:null}),start()})}),test("jQuery.get(String, Function) - data in ajaxSettings (#8277)",function(){expect(1),stop(),jQuery.ajaxSetup({data:"helloworld"}),jQuery.get(url("data/echoQuery.php"),function(e){ok(/helloworld$/.test(e),"Data from ajaxSettings was used"),jQuery.ajaxSetup({data:null}),start()})}),test("jQuery.get(String, Hash, Function) - parse xml and use text() on nodes",function(){expect(2),stop(),jQuery.get(url("data/dashboard.xml"),function(e){var t=[];jQuery("tab",e).each(function(){t.push(jQuery(this).text())}),equal(t[0],"blabla","Check first tab"),equal(t[1],"blublu","Check second tab"),start()})}),test("jQuery.getScript(String, Function) - with callback",function(){expect(3),stop(),jQuery.getScript(url("data/test.js"),function(e,t,a){equal(foobar,"bar","Check if script was evaluated"),strictEqual(e,a.responseText,"Same-domain script requests returns the source of the script (#8082)"),setTimeout(function(){start()},1e3)})}),test("jQuery.getScript(String, Function) - no callback",function(){expect(1),stop(),jQuery.getScript(url("data/test.js"),function(){start()})}),jQuery.each(["Same Domain","Cross Domain"],function(e,t){test("jQuery.ajax() - JSONP, "+t,function(){function t(){20==++a&&start()}expect(24);var a=0;stop(),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,"JSON results returned (GET, no callback)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, no callback)"),t()}}),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,(this.alreadyDone?"this re-used":"first request")+": JSON results returned (GET, no callback)"),this.alreadyDone?t():(this.alreadyDone=!0,jQuery.ajax(this))},error:function(){ok(!1,"Ajax error JSON (GET, no callback)"),t()}}),jQuery.ajax({url:"data/jsonp.php?callback=?",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,"JSON results returned (GET, url callback)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, url callback)"),t()}}),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,data:"callback=?",success:function(e){ok(e.data,"JSON results returned (GET, data callback)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, data callback)"),t()}}),jQuery.ajax({url:"data/jsonp.php?callback=??",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,"JSON results returned (GET, url context-free callback)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, url context-free callback)"),t()}}),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,data:"callback=??",success:function(e){ok(e.data,"JSON results returned (GET, data context-free callback)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, data context-free callback)"),t()}}),jQuery.ajax({url:"data/jsonp.php/??",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,"JSON results returned (GET, REST-like)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, REST-like)"),t()}}),jQuery.ajax({url:"data/jsonp.php/???json=1",dataType:"jsonp",crossDomain:e,success:function(e){strictEqual(jQuery.type(e),"array","JSON results returned (GET, REST-like with param)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, REST-like with param)"),t()}}),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,jsonp:"callback",success:function(e){ok(e.data,"JSON results returned (GET, data obj callback)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, data obj callback)"),t()}}),window.jsonpResults=function(e){ok(e.data,"JSON results returned (GET, custom callback function)"),window.jsonpResults=void 0,t()},jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,jsonpCallback:"jsonpResults",success:function(e){ok(e.data,"JSON results returned (GET, custom callback name)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, custom callback name)"),t()}}),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,jsonpCallback:"functionToCleanUp",success:function(a){ok(a.data,"JSON results returned (GET, custom callback name to be cleaned up)"),strictEqual(window.functionToCleanUp,void 0,"Callback was removed (GET, custom callback name to be cleaned up)"),t();var o;jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,jsonpCallback:"functionToCleanUp",beforeSend:function(e){return o=e,!1}}),o.error(function(){ok(!0,"Ajax error JSON (GET, custom callback name to be cleaned up)"),strictEqual(window.functionToCleanUp,void 0,"Callback was removed after early abort (GET, custom callback name to be cleaned up)"),t()})},error:function(){ok(!1,"Ajax error JSON (GET, custom callback name to be cleaned up)"),t()}}),jQuery.ajax({type:"POST",url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,"JSON results returned (POST, no callback)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, data obj callback)"),t()}}),jQuery.ajax({type:"POST",url:"data/jsonp.php",data:"callback=?",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,"JSON results returned (POST, data callback)"),t()},error:function(){ok(!1,"Ajax error JSON (POST, data callback)"),t()}}),jQuery.ajax({type:"POST",url:"data/jsonp.php",jsonp:"callback",dataType:"jsonp",crossDomain:e,success:function(e){ok(e.data,"JSON results returned (POST, data obj callback)"),t()},error:function(){ok(!1,"Ajax error JSON (POST, data obj callback)"),t()}}),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,beforeSend:function(){return strictEqual(this.cache,!1,"cache must be false on JSON request"),t(),!1}}),jQuery.ajax({url:"data/jsonp.php?callback=XXX",dataType:"jsonp",jsonp:!1,jsonpCallback:"XXX",crossDomain:e,beforeSend:function(){ok(/^data\/jsonp.php\?callback=XXX&_=\d+$/.test(this.url),"The URL wasn't messed with (GET, custom callback name with no url manipulation)"),t()},success:function(e){ok(e.data,"JSON results returned (GET, custom callback name with no url manipulation)"),t()},error:function(){ok(!1,"Ajax error JSON (GET, custom callback name with no url manipulation)"),t()}}),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,beforeSend:function(){this.callback=this.jsonpCallback}}).pipe(function(){var t=this;strictEqual(t.jsonpCallback,void 0,"jsonpCallback option is set back to default in callbacks"),jQuery.ajax({url:"data/jsonp.php",dataType:"jsonp",crossDomain:e,beforeSend:function(){return strictEqual(this.jsonpCallback,t.callback,"JSONP callback name is re-used"),!1}})}).always(t)})}),test("jQuery.ajax() - script, Remote",function(){expect(2);var e=window.location.href.replace(/[^\/]*$/,"");stop(),jQuery.ajax({url:e+"data/test.js",dataType:"script",success:function(){ok(window.foobar,"Script results returned (GET, no callback)"),start()}})}),test("jQuery.ajax() - script, Remote with POST",function(){expect(3);var e=window.location.href.replace(/[^\/]*$/,"");stop(),jQuery.ajax({url:e+"data/test.js",type:"POST",dataType:"script",success:function(e,t){ok(window.foobar,"Script results returned (POST, no callback)"),equal(t,"success","Script results returned (POST, no callback)"),start()},error:function(e){ok(!1,"ajax error, status code: "+e.status),start()}})}),test("jQuery.ajax() - script, Remote with scheme-less URL",function(){expect(2);var e=window.location.href.replace(/[^\/]*$/,"");e=e.replace(/^.*?\/\//,"//"),stop(),jQuery.ajax({url:e+"data/test.js",dataType:"script",success:function(){ok(window.foobar,"Script results returned (GET, no callback)"),start()}})}),test("jQuery.ajax() - malformed JSON",function(){expect(2),stop(),jQuery.ajax({url:"data/badjson.js",dataType:"json",success:function(){ok(!1,"Success."),start()},error:function(e,t,a){equal("parsererror",t,"A parse error occurred."),ok(/(invalid|error|exception)/i.test(a),"Detailed parsererror message provided"),start()}})}),test("jQuery.ajax() - script, throws exception (#11743)",function(){expect(1),raises(function(){jQuery.ajax({url:"data/badjson.js",dataType:"script","throws":!0,async:!1,global:!1,success:function(){ok(!1,"Success.")},error:function(){ok(!1,"Error.")}})},"exception bubbled")}),test("jQuery.ajax() - script by content-type",function(){expect(2),stop(),jQuery.when(jQuery.ajax({url:"data/script.php",data:{header:"script"}}),jQuery.ajax({url:"data/script.php",data:{header:"ecma"}})).always(function(){start()})}),test("jQuery.ajax() - json by content-type",function(){expect(5),stop(),jQuery.ajax({url:"data/json.php",data:{header:"json",json:"array"},success:function(e){ok(e.length>=2,"Check length"),equal(e[0].name,"John","Check JSON: first, name"),equal(e[0].age,21,"Check JSON: first, age"),equal(e[1].name,"Peter","Check JSON: second, name"),equal(e[1].age,25,"Check JSON: second, age"),start()}})}),test("jQuery.ajax() - json by content-type disabled with options",function(){expect(6),stop(),jQuery.ajax({url:url("data/json.php"),data:{header:"json",json:"array"},contents:{json:!1},success:function(e){equal(typeof e,"string","json wasn't auto-determined");var t=jQuery.parseJSON(e);ok(t.length>=2,"Check length"),equal(t[0].name,"John","Check JSON: first, name"),equal(t[0].age,21,"Check JSON: first, age"),equal(t[1].name,"Peter","Check JSON: second, name"),equal(t[1].age,25,"Check JSON: second, age"),start()}})}),test("jQuery.getJSON(String, Hash, Function) - JSON array",function(){expect(5),stop(),jQuery.getJSON(url("data/json.php"),{json:"array"},function(e){ok(e.length>=2,"Check length"),equal(e[0].name,"John","Check JSON: first, name"),equal(e[0].age,21,"Check JSON: first, age"),equal(e[1].name,"Peter","Check JSON: second, name"),equal(e[1].age,25,"Check JSON: second, age"),start()})}),test("jQuery.getJSON(String, Function) - JSON object",function(){expect(2),stop(),jQuery.getJSON(url("data/json.php"),function(e){e&&e.data&&(equal(e.data.lang,"en","Check JSON: lang"),equal(e.data.length,25,"Check JSON: length")),start()})}),asyncTest("jQuery.getJSON - Using Native JSON",function(){expect(2);var e=window.JSON;window.JSON={parse:function(){return ok(!0,"Verifying that parse method was run"),!0}},jQuery.getJSON(url("data/json.php"),function(t){window.JSON=e,equal(t,!0,"Verifying return value"),start()
})}),test("jQuery.getJSON(String, Function) - JSON object with absolute url to local content",function(){expect(2);var e=window.location.href.replace(/[^\/]*$/,"");stop(),jQuery.getJSON(url(e+"data/json.php"),function(e){equal(e.data.lang,"en","Check JSON: lang"),equal(e.data.length,25,"Check JSON: length"),start()})}),test("jQuery.post - data",3,function(){stop(),jQuery.when(jQuery.post(url("data/name.php"),{xml:"5-2",length:3},function(e){jQuery("math",e).each(function(){equal(jQuery("calculation",this).text(),"5-2","Check for XML"),equal(jQuery("result",this).text(),"3","Check for XML")})}),jQuery.ajax({url:url("data/echoData.php"),type:"POST",data:{test:{length:7,foo:"bar"}},success:function(e){strictEqual(e,"test%5Blength%5D=7&test%5Bfoo%5D=bar","Check if a sub-object with a length param is serialized correctly")}})).always(function(){start()})}),test("jQuery.post(String, Hash, Function) - simple with xml",function(){expect(4),stop();var e=0;jQuery.post(url("data/name.php"),{xml:"5-2"},function(t){jQuery("math",t).each(function(){equal(jQuery("calculation",this).text(),"5-2","Check for XML"),equal(jQuery("result",this).text(),"3","Check for XML")}),2===++e&&start()}),jQuery.post(url("data/name.php?xml=5-2"),{},function(t){jQuery("math",t).each(function(){equal(jQuery("calculation",this).text(),"5-2","Check for XML"),equal(jQuery("result",this).text(),"3","Check for XML")}),2===++e&&start()})}),test("jQuery.ajaxSetup({timeout: Number}) - with global timeout",function(){stop();var e=0;jQuery.ajaxSetup({timeout:1e3});var t=function(){e++,2==e&&(ok(!0,"Check local and global callbacks after timeout"),jQuery("#qunit-fixture").unbind("ajaxError"),start())},a=function(e,t){ok(!1,"Check for timeout failed "+e+" "+t),start()};jQuery("#qunit-fixture").ajaxError(t),jQuery.ajax({type:"GET",url:url("data/name.php?wait=5"),error:t,success:a}),jQuery.ajaxSetup({timeout:0})}),test("jQuery.ajaxSetup({timeout: Number}) with localtimeout",function(){stop(),jQuery.ajaxSetup({timeout:50}),jQuery.ajax({type:"GET",timeout:15e3,url:url("data/name.php?wait=1"),error:function(){ok(!1,"Check for local timeout failed"),start()},success:function(){ok(!0,"Check for local timeout"),start()}}),jQuery.ajaxSetup({timeout:0})}),test("jQuery.ajax - simple get",function(){expect(1),stop(),jQuery.ajax({type:"GET",url:url("data/name.php?name=foo"),success:function(e){equal(e,"bar","Check for GET"),start()}})}),test("jQuery.ajax - simple post",function(){expect(1),stop(),jQuery.ajax({type:"POST",url:url("data/name.php"),data:"name=peter",success:function(e){equal(e,"pan","Check for POST"),start()}})}),test("ajaxSetup()",function(){expect(1),stop(),jQuery.ajaxSetup({url:url("data/name.php?name=foo"),success:function(e){equal(e,"bar","Check for GET"),start()}}),jQuery.ajax()}),test("data option: evaluate function values (#2806)",function(){stop(),jQuery.ajax({url:"data/echoQuery.php",data:{key:function(){return"value"}},success:function(e){equal(e,"key=value"),start()}})}),test("data option: empty bodies for non-GET requests",function(){stop(),jQuery.ajax({url:"data/echoData.php",data:void 0,type:"post",success:function(e){equal(e,""),start()}})});var ifModifiedNow=new Date;jQuery.each({" (cache)":!0," (no cache)":!1},function(e,t){test("jQuery.ajax - If-Modified-Since support"+e,function(){expect(3),stop();var e="data/if_modified_since.php?ts="+ifModifiedNow++;jQuery.ajax({url:e,ifModified:!0,cache:t,success:function(a,o){equal(o,"success"),jQuery.ajax({url:e,ifModified:!0,cache:t,success:function(e,t){"FAIL"===e?(ok(isOpera,"Opera is incapable of doing .setRequestHeader('If-Modified-Since')."),ok(isOpera,"Opera is incapable of doing .setRequestHeader('If-Modified-Since').")):(equal(t,"notmodified"),ok(null==e,"response body should be empty")),start()},error:function(){ok(isOpera,"error"),ok(isOpera,"error"),start()}})},error:function(){equal(!1,"error"),ok(isOpera,"error"),start()}})}),test("jQuery.ajax - Etag support"+e,function(){expect(3),stop();var e="data/etag.php?ts="+ifModifiedNow++;jQuery.ajax({url:e,ifModified:!0,cache:t,success:function(a,o){equal(o,"success"),jQuery.ajax({url:e,ifModified:!0,cache:t,success:function(e,t){"FAIL"===e?(ok(isOpera,"Opera is incapable of doing .setRequestHeader('If-None-Match')."),ok(isOpera,"Opera is incapable of doing .setRequestHeader('If-None-Match').")):(equal(t,"notmodified"),ok(null==e,"response body should be empty")),start()},error:function(){ok(isOpera,"error"),ok(isOpera,"error"),start()}})},error:function(){ok(isOpera,"error"),start()}})})}),test("jQuery ajax - failing cross-domain",function(){expect(2),stop();var e=2;jQuery.ajax({url:"http://somewebsitethatdoesnotexist-67864863574657654.com",success:function(){ok(!1,"success")},error:function(e,t,a){ok(!0,"file not found: "+e.status+" => "+a)},complete:function(){--e||start()}}),jQuery.ajax({url:"http://www.google.com",success:function(){ok(!1,"success")},error:function(e,t,a){ok(!0,"access denied: "+e.status+" => "+a)},complete:function(){--e||start()}})}),test("jQuery ajax - atom+xml",function(){stop(),jQuery.ajax({url:url("data/atom+xml.php"),success:function(){ok(!0,"success")},error:function(){ok(!1,"error")},complete:function(){start()}})}),test("jQuery.ajax - Location object as url (#7531)",1,function(){var e=!1;try{var t=jQuery.ajax({url:window.location});e=!0,t.abort()}catch(a){}ok(e,"document.location did not generate exception")}),test("jQuery.ajax - Context with circular references (#9887)",2,function(){var e=!1,t={};t.field=t;try{jQuery.ajax("non-existing",{context:t,beforeSend:function(){return ok(this===t,"context was not deep extended"),!1}}),e=!0}catch(a){console.log(a)}ok(e,"context with circular reference did not generate an exception")}),test("jQuery.ajax - statusText",3,function(){stop(),jQuery.ajax(url("data/statusText.php?status=200&text=Hello")).done(function(e,t,a){strictEqual(t,"success","callback status text ok for success"),ok("Hello"===a.statusText||"OK"===a.statusText,"jqXHR status text ok for success ("+a.statusText+")"),jQuery.ajax(url("data/statusText.php?status=404&text=World")).fail(function(e,t){strictEqual(t,"error","callback status text ok for error"),start()})})}),test("jQuery.ajax - statusCode",function(){function e(){--a||start()}function t(e,t){return e="Test "+e+" "+(t?"success":"error"),{200:function(){ok(t,e)},404:function(){ok(!t,e)}}}var a=12;expect(20),stop(),jQuery.each({"data/name.html":!0,"data/someFileThatDoesNotExist.html":!1},function(a,o){jQuery.ajax(url(a),{statusCode:t("in options",o),complete:e}),jQuery.ajax(url(a),{complete:e}).statusCode(t("immediately with method",o)),jQuery.ajax(url(a),{complete:function(a){a.statusCode(t("on complete",o)),e()}}),jQuery.ajax(url(a),{complete:function(a){setTimeout(function(){a.statusCode(t("very late binding",o)),e()},100)}}),jQuery.ajax(url(a),{statusCode:t("all (options)",o),complete:function(a){a.statusCode(t("all (on complete)",o)),setTimeout(function(){a.statusCode(t("all (very late binding)",o)),e()},100)}}).statusCode(t("all (immediately with method)",o));var r="";jQuery.ajax(url(a),{success:function(e,t,a){ok(o,"success");var n={};n[a.status]=function(){r+="B"},a.statusCode(n),r+="A"},error:function(e){ok(!o,"error");var t={};t[e.status]=function(){r+="B"},e.statusCode(t),r+="A"},complete:function(){strictEqual(r,"AB","Test statusCode callbacks are ordered like "+(o?"success":"error")+" callbacks"),e()}})})}),test("jQuery.ajax - transitive conversions",function(){expect(8),stop(),jQuery.when(jQuery.ajax(url("data/json.php"),{converters:{"json myJson":function(e){return ok(!0,"converter called"),e}},dataType:"myJson",success:function(){ok(!0,"Transitive conversion worked"),strictEqual(this.dataTypes[0],"text","response was retrieved as text"),strictEqual(this.dataTypes[1],"myjson","request expected myjson dataType")}}),jQuery.ajax(url("data/json.php"),{converters:{"json myJson":function(e){return ok(!0,"converter called (*)"),e}},contents:!1,dataType:"* myJson",success:function(){ok(!0,"Transitive conversion worked (*)"),strictEqual(this.dataTypes[0],"text","response was retrieved as text (*)"),strictEqual(this.dataTypes[1],"myjson","request expected myjson dataType (*)")}})).always(function(){start()})}),test("jQuery.ajax - overrideMimeType",function(){expect(2),stop(),jQuery.when(jQuery.ajax(url("data/json.php"),{beforeSend:function(e){e.overrideMimeType("application/json")},success:function(e){ok(e.data,"Mimetype overriden using beforeSend")}}),jQuery.ajax(url("data/json.php"),{mimeType:"application/json",success:function(e){ok(e.data,"Mimetype overriden using mimeType option")}})).always(function(){start()})}),test("jQuery.ajax - abort in prefilter",function(){expect(1),jQuery.ajaxPrefilter(function(e,t,a){e.abortInPrefilter&&a.abort()}),jQuery.ajax({abortInPrefilter:!0,error:function(){ok(!1,"error callback called")}}).fail(function(e,t){strictEqual(t,"canceled","Request aborted by the prefilter must fail with 'canceled' status text")})}),test("jQuery.ajax - loading binary data shouldn't throw an exception in IE (#11426)",1,function(){stop(),jQuery.ajax(url("data/1x1.jpg"),{success:function(e){ok(void 0===e||/JFIF/.test(e),"success callback reached"),start()},error:function(e,t,a){ok(!1,"exception thrown: '"+a+"'"),start()}})}),test("jQuery.domManip - no side effect because of ajaxSetup or global events (#11264)",function(){expect(1),jQuery.ajaxSetup({type:"POST"}),jQuery(document).bind("ajaxStart ajaxStop",function(){ok(!1,"Global event triggered")}),jQuery("#qunit-fixture").append("<script src='data/evalScript.php'></script>"),jQuery(document).unbind("ajaxStart ajaxStop"),jQuery.ajaxSetup({type:"GET"})}),test("jQuery.domManip - script in comments are properly evaluated (#11402)",function(){expect(2),stop(),jQuery("#qunit-fixture").load("data/cleanScript.html",function(){start()})}),test("jQuery.ajax - active counter",function(){ok(0===jQuery.active,"ajax active counter should be zero: "+jQuery.active)})}