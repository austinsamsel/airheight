module("callbacks",{teardown:moduleTeardown}),function(){function t(t){if("string"==typeof t)return'"'+t+'"';var i,e=[];for(i in t)e.push('"'+i+'": '+t[i]);return"{ "+e.join(", ")+" }"}var i,e=function(t){return function(){i+=t}},a=e("A"),n=e("B"),r=e("C"),X={"":"XABC   X     XABCABCC  X  XBB X   XABA  X   XX",once:"XABC   X     X         X  X   X   XABA  X   XX",memory:"XABC   XABC  XABCABCCC XA XBB XB  XABA  XC  XX",unique:"XABC   X     XABCA     X  XBB X   XAB   X   X",stopOnFalse:"XABC   X     XABCABCC  X  XBB X   XA    X   XX","once memory":"XABC   XABC  X         XA X   XA  XABA  XC  XX","once unique":"XABC   X     X         X  X   X   XAB   X   X","once stopOnFalse":"XABC   X     X         X  X   X   XA    X   XX","memory unique":"XABC   XA    XABCA     XA XBB XB  XAB   XC  X","memory stopOnFalse":"XABC   XABC  XABCABCCC XA XBB XB  XA    X   XX","unique stopOnFalse":"XABC   X     XABCA     X  XBB X   XA    X   X"},l={"no filter":void 0,filter:function(t){return function(){return t.apply(this,arguments)}}};jQuery.each(X,function(e,X){var c={};jQuery.each(e.split(" "),function(){this.length&&(c[this]=!0)}),jQuery.each(l,function(l){jQuery.each({string:e,object:c},function(e,c){test("jQuery.Callbacks( "+t(c)+" ) - "+l,function(){function t(){i+="X"}expect(21),stop(),setTimeout(start,0);var e,l=X.split(/\s+/);i="X",e=jQuery.Callbacks(c),e.add(function(t){i+=t}),e.fire("A"),strictEqual(i,"XA","Basic binding and firing"),strictEqual(e.fired(),!0,".fired() detects firing"),i="X",e.disable(),e.add(function(t){i+=t}),strictEqual(i,"X","Adding a callback after disabling"),e.fire("A"),strictEqual(i,"X","Firing after disabling"),i="X",e=jQuery.Callbacks(c),e.add(function(){equal(this,window,"Basic binding and firing (context)"),i+=Array.prototype.join.call(arguments,"")}),e.fireWith(window,["A","B"]),strictEqual(i,"XAB","Basic binding and firing (arguments)"),i="",e=jQuery.Callbacks(c),e.add(function(){equal(this,window,"fireWith with no arguments (context is window)"),strictEqual(arguments.length,0,"fireWith with no arguments (no arguments)")}),e.fireWith(),i="X",e=jQuery.Callbacks(c),e.add(a,n,r),e.remove(n,r),e.fire(),strictEqual(i,"XA","Basic binding, removing and firing"),i="X",e=jQuery.Callbacks(c),e.add(a),e.add(n),e.add(r),e.empty(),e.fire(),strictEqual(i,"X","Empty"),i="X",e=jQuery.Callbacks(c),e.add(function(t){i+=t}),e.lock(),e.add(function(t){i+=t}),e.fire("A"),e.add(function(t){i+=t}),strictEqual(i,"X","Lock early"),i="X",e=jQuery.Callbacks(c),e.add(function(){e.add(r),a()},n),e.fire(),strictEqual(i,l.shift(),"Proper ordering"),i="X",e.add(function(){e.add(r),a()},n),strictEqual(i,l.shift(),"Add after fire"),i="X",e.fire(),strictEqual(i,l.shift(),"Fire again"),i="X",e=jQuery.Callbacks(c),e.add(function(t){i+=t}),e.fire("A"),strictEqual(i,"XA","Multiple fire (first fire)"),i="X",e.add(function(t){i+=t}),strictEqual(i,l.shift(),"Multiple fire (first new callback)"),i="X",e.fire("B"),strictEqual(i,l.shift(),"Multiple fire (second fire)"),i="X",e.add(function(t){i+=t}),strictEqual(i,l.shift(),"Multiple fire (second new callback)"),i="X",e=jQuery.Callbacks(c),e.add(a,function(){return!1},n),e.add(a),e.fire(),strictEqual(i,l.shift(),"Callback returning false"),i="X",e.add(r),strictEqual(i,l.shift(),"Adding a callback after one returned false"),i="",t.method=function(){i+="!"},e=jQuery.Callbacks(c),e.add(t),e.add(t),e.fire(),strictEqual(i,l.shift(),"No callback iteration")})})})})}(),test("jQuery.Callbacks( options ) - options are copied",function(){expect(1);var t={unique:!0},i=jQuery.Callbacks(t),e=0,a=function(){ok(!e++,"called once")};t.unique=!1,i.add(a,a),i.fire()}),test("jQuery.Callbacks.fireWith - arguments are copied",function(){expect(1);var t=jQuery.Callbacks("memory"),i=["hello"];t.fireWith(null,i),i[0]="world",t.add(function(t){strictEqual(t,"hello","arguments are copied internally")})}),test("jQuery.Callbacks.remove - should remove all instances",function(){function t(){ok(!1,"function wasn't removed")}expect(1);var i=jQuery.Callbacks();i.add(t,t,function(){ok(!0,"end of test")}).remove(t).fire()}),test("jQuery.Callbacks() - adding a string doesn't cause a stack overflow",function(){expect(1),jQuery.Callbacks().add("hello world"),ok(!0,"no stack overflow")});