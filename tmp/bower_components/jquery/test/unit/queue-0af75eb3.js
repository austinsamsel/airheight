module("queue",{teardown:moduleTeardown}),test("queue() with other types",14,function(){stop();var e=jQuery({}),u=0;e.promise("foo").done(function(){equal(u,0,"Deferred for collection with no queue is automatically resolved")}),e.queue("foo",function(){equal(++u,1,"Dequeuing"),jQuery.dequeue(this,"foo")}).queue("foo",function(){equal(++u,2,"Dequeuing"),jQuery(this).dequeue("foo")}).queue("foo",function(){equal(++u,3,"Dequeuing")}).queue("foo",function(){equal(++u,4,"Dequeuing")}),e.promise("foo").done(function(){equal(u,4,"Testing previous call to dequeue in deferred"),start()}),equal(e.queue("foo").length,4,"Testing queue length"),equal(e.queue("foo",void 0).queue("foo").length,4,".queue('name',undefined) does nothing but is chainable (#5571)"),e.dequeue("foo"),equal(u,3,"Testing previous call to dequeue"),equal(e.queue("foo").length,1,"Testing queue length"),e.dequeue("foo"),equal(u,4,"Testing previous call to dequeue"),equal(e.queue("foo").length,0,"Testing queue length"),e.dequeue("foo"),equal(u,4,"Testing previous call to dequeue"),equal(e.queue("foo").length,0,"Testing queue length")}),test("queue(name) passes in the next item in the queue as a parameter",function(){expect(2);var e=jQuery({}),u=0;e.queue("foo",function(e){equal(++u,1,"Dequeueing"),e()}).queue("foo",function(e){equal(++u,2,"Next was called"),e()}).queue("bar",function(){equal(++u,3,"Other queues are not triggered by next()")}),e.dequeue("foo")}),test("queue() passes in the next item in the queue as a parameter to fx queues",function(){expect(3),stop();var e=jQuery({}),u=0;e.queue(function(e){equal(++u,1,"Dequeueing"),setTimeout(function(){e()},500)}).queue(function(e){equal(++u,2,"Next was called"),e()}).queue("bar",function(){equal(++u,3,"Other queues are not triggered by next()")}),jQuery.when(e.promise("fx"),e).done(function(){equal(u,2,"Deferreds resolved"),start()})}),test("callbacks keep their place in the queue",function(){expect(5),stop();var e=jQuery("<div>"),u=0;e.queue(function(e){equal(++u,1,"Queue/callback order: first called"),setTimeout(e,200)}).delay(100).queue(function(e){equal(++u,2,"Queue/callback order: second called"),jQuery(this).delay(100).queue(function(e){equal(++u,4,"Queue/callback order: fourth called"),e()}),e()}).queue(function(e){equal(++u,3,"Queue/callback order: third called"),e()}),e.promise("fx").done(function(){equal(u,4,"Deferreds resolved"),start()})}),test("delay()",function(){expect(2),stop();var e=jQuery({}),u=0;e.delay(100).queue(function(){u=1,ok(!0,"The function was dequeued."),start()}),equal(u,0,"The delay delayed the next function from running.")}),test("clearQueue(name) clears the queue",function(){expect(2),stop();var e=jQuery({}),u=0;e.queue("foo",function(e){u++,jQuery(this).clearQueue("foo"),e()}).queue("foo",function(){u++}),e.promise("foo").done(function(){ok(!0,"dequeue resolves the deferred"),start()}),e.dequeue("foo"),equal(u,1,"the queue was cleared")}),test("clearQueue() clears the fx queue",function(){expect(1);var e=jQuery({}),u=0;e.queue(function(e){u++;var t=this;setTimeout(function(){jQuery(t).clearQueue(),e()},50)}).queue(function(){u++}),equal(u,1,"the queue was cleared"),e.removeData()}),asyncTest("fn.promise() - called when fx queue is empty",3,function(){var e=jQuery("#foo").clone().addBack(),u=!1;e.queue(function(e){ok(!u,"Promised hasn't been called"),setTimeout(e,10)}),e.promise().done(function(){ok(u=!0,"Promised"),start()})}),asyncTest('fn.promise( "queue" ) - called whenever last queue function is dequeued',5,function(){var e,u=jQuery("#foo");u.promise("queue").done(function(){strictEqual(e,void 0,"called immediately when queue was already empty")}),e=1,u.queue("queue",function(u){strictEqual(e++,1,"step one"),setTimeout(u,0)}).queue("queue",function(u){strictEqual(e++,2,"step two"),setTimeout(function(){u(),strictEqual(e++,4,"step four"),start()},10)}).promise("queue").done(function(){strictEqual(e++,3,"step three")}),u.dequeue("queue")}),asyncTest('fn.promise( "queue" ) - waits for animation to complete before resolving',2,function(){var e=jQuery("#foo"),u=1;e.animate({top:100},{duration:1,queue:"queue",complete:function(){strictEqual(u++,1,"step one")}}).dequeue("queue"),e.promise("queue").done(function(){strictEqual(u++,2,"step two"),start()})}),test(".promise(obj)",function(){expect(2);var e={},u=jQuery("#foo").promise("promise",e);ok(jQuery.isFunction(u.promise),".promise(type, obj) returns a promise"),strictEqual(u,e,".promise(type, obj) returns obj")}),jQuery.fn.stop&&(test("delay() can be stopped",function(){expect(3),stop();var e={};jQuery({}).queue("alternate",function(u){e.alt1=!0,ok(!0,"This first function was dequeued"),u()}).delay(1e3,"alternate").queue("alternate",function(){e.alt2=!0,ok(!0,"The function was dequeued immediately, the delay was stopped")}).dequeue("alternate").stop("alternate",!1,!1).delay(1).queue(function(){e.default1=!0,ok(!1,"This queue should never run")}).stop(!0,!1),deepEqual(e,{alt1:!0,alt2:!0},"Queue ran the proper functions"),setTimeout(function(){start()},1500)}),asyncTest("queue stop hooks",2,function(){var e=jQuery("#foo");e.queue(function(e,u){u.stop=function(e){equal(!!e,!1,"Stopped without gotoEnd")}}),e.stop(),e.queue(function(e,u){u.stop=function(e){equal(e,!0,"Stopped with gotoEnd"),start()}}),e.stop(!1,!0)}));