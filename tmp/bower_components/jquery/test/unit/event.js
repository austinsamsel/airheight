module("event",{teardown:moduleTeardown}),test("null or undefined handler",function(){expect(2);try{jQuery("#firstp").click(null),ok(!0,"Passing a null handler will not throw an exception")}catch(e){}try{jQuery("#firstp").click(void 0),ok(!0,"Passing an undefined handler will not throw an exception")}catch(e){}}),test("bind(),live(),delegate() with non-null,defined data",function(){expect(3);var e=function(e,t){equal(t,0,"non-null, defined data (zero) is correctly passed")};jQuery("#foo").bind("foo",e),jQuery("#foo").live("foo",e),jQuery("div").delegate("#foo","foo",e),jQuery("#foo").trigger("foo",0),jQuery("#foo").unbind("foo",e),jQuery("#foo").die("foo",e),jQuery("div").undelegate("#foo","foo")}),test("Handler changes and .trigger() order",function(){expect(1);var e=jQuery('<div><div><p><span><b class="a">b</b></span></p></div></div>'),t="";e.find("*").andSelf().on("click",function(){t+=this.nodeName.toLowerCase()+" "}).filter("b").on("click",function(e){e.target===this&&jQuery(this).parent().remove()}),e.find("b").trigger("click"),equal(t,"b p div div ","Delivered all events"),e.remove()}),test("bind(), with data",function(){expect(4);var e=function(e){ok(e.data,"bind() with data, check passed data exists"),equal(e.data.foo,"bar","bind() with data, Check value of passed data")};jQuery("#firstp").bind("click",{foo:"bar"},e).click().unbind("click",e),ok(!jQuery._data(jQuery("#firstp")[0],"events"),"Event handler unbound when using data.");var t=function(){},i=function(e){equal(e.data,t,"bind() with function data, Check value of passed data")};jQuery("#firstp").bind("click",t,i).click().unbind("click",i)}),test("click(), with data",function(){expect(3);var e=function(e){ok(e.data,"bind() with data, check passed data exists"),equal(e.data.foo,"bar","bind() with data, Check value of passed data")};jQuery("#firstp").click({foo:"bar"},e).click().unbind("click",e),ok(!jQuery._data(jQuery("#firstp")[0],"events"),"Event handler unbound when using data.")}),test("bind(), with data, trigger with data",function(){expect(4);var e=function(e,t){ok(e.data,"check passed data exists"),equal(e.data.foo,"bar","Check value of passed data"),ok(t,"Check trigger data"),equal(t.bar,"foo","Check value of trigger data")};jQuery("#firstp").bind("click",{foo:"bar"},e).trigger("click",[{bar:"foo"}]).unbind("click",e)}),test("bind(), multiple events at once",function(){expect(2);var e=0,t=0,i=function(i){"click"==i.type?e+=1:"mouseover"==i.type&&(t+=1)};jQuery("#firstp").bind("click mouseover",i).trigger("click").trigger("mouseover"),equal(e,1,"bind() with multiple events at once"),equal(t,1,"bind() with multiple events at once")}),test("bind(), five events at once",function(){expect(1);var e=0,t=function(){e++};jQuery("#firstp").bind("click mouseover foo bar baz",t).trigger("click").trigger("mouseover").trigger("foo").trigger("bar").trigger("baz"),equal(e,5,"bind() five events at once")}),test("bind(), multiple events at once and namespaces",function(){expect(7);var e,t={},i=jQuery("<div/>").bind("focusin.a",function(t){equal(t.type,e,"Verify right single event was fired.")});e="focusin",i.trigger("focusin.a"),i.remove(),i=jQuery("<div/>").bind("click mouseover",t,function(i){equal(i.type,e,"Verify right multi event was fired."),equal(i.data,t,"Make sure the data came in correctly.")}),e="click",i.trigger("click"),e="mouseover",i.trigger("mouseover"),i.remove(),i=jQuery("<div/>").bind("focusin.a focusout.b",function(t){equal(t.type,e,"Verify right multi event was fired.")}),e="focusin",i.trigger("focusin.a"),e="focusout",i.trigger("focusout.b"),i.remove()}),test("bind(), namespace with special add",function(){expect(27);var e=jQuery("<div/>").bind("test",function(){ok(!0,"Test event fired.")}),t=0;jQuery.event.special.test={_default:function(t,i){equal(this,document,"Make sure we're at the top of the chain."),equal(t.type,"test","And that we're still dealing with a test event."),equal(t.target,e[0],"And that the target is correct."),ok(void 0!==i,"And that trigger data was passed.")},setup:function(){},teardown:function(){ok(!0,"Teardown called.")},add:function(e){var i=e.handler;e.handler=function(e){e.xyz=++t,i.apply(this,arguments)}},remove:function(){ok(!0,"Remove called.")}},e.bind("test.a",{x:1},function(e){ok(!!e.xyz,"Make sure that the data is getting passed through."),equal(e.data.x,1,"Make sure data is attached properly.")}),e.bind("test.b",{x:2},function(e){ok(!!e.xyz,"Make sure that the data is getting passed through."),equal(e.data.x,2,"Make sure data is attached properly.")}),e.trigger("test",33.33),e.trigger("test.a","George Harrison"),e.trigger("test.b",{year:1982}),e.unbind("test"),e=jQuery("<div/>").bind("test",function(){ok(!0,"Test event fired.")}),e.appendTo("#qunit-fixture").remove(),delete jQuery.event.special.test}),test("bind(), no data",function(){expect(1);var e=function(e){ok(!e.data,"Check that no data is added to the event object")};jQuery("#firstp").bind("click",e).trigger("click")}),test("bind/one/unbind(Object)",function(){function e(e){"click"==e.type?n++:"mouseover"==e.type&&r++}function t(e){"click"==e.type?n+=e.data:"mouseover"==e.type&&(r+=e.data)}function i(){o.trigger("click").trigger("mouseover")}expect(6);var n=0,r=0,o=jQuery("#firstp").bind({click:e,mouseover:e}).one({click:t,mouseover:t},2);i(),equal(n,3,"bind(Object)"),equal(r,3,"bind(Object)"),i(),equal(n,4,"bind(Object)"),equal(r,4,"bind(Object)"),jQuery("#firstp").unbind({click:e,mouseover:e}),i(),equal(n,4,"bind(Object)"),equal(r,4,"bind(Object)")}),test("live/die(Object), delegate/undelegate(String, Object)",function(){function e(){r.trigger("click").trigger("mouseover")}expect(6);var t=0,i=0,n=jQuery("#firstp"),r=n.find("a:first"),o={click:function(e){t+=e.data||1},mouseover:function(e){i+=e.data||1}};r.live(o),n.delegate("a",o,2),e(),equal(t,3,"live/delegate"),equal(i,3,"live/delegate"),n.undelegate("a",o),e(),equal(t,4,"undelegate"),equal(i,4,"undelegate"),r.die(o),e(),equal(t,4,"die"),equal(i,4,"die")}),test("live/delegate immediate propagation",function(){expect(2);var e,t=jQuery("#firstp"),i=t.find("a:first");e="",i.live("click",function(t){e="click1",t.stopImmediatePropagation()}),i.live("click",function(){e="click2"}),i.trigger("click"),equal(e,"click1","live stopImmediatePropagation"),i.die("click"),e="",t.delegate("a","click",function(t){e="click1",t.stopImmediatePropagation()}),t.delegate("a","click",function(){e="click2"}),i.trigger("click"),equal(e,"click1","delegate stopImmediatePropagation"),t.undelegate("click")}),test("bind/delegate bubbling, isDefaultPrevented",function(){expect(2);var e=jQuery("#anchor2"),t=jQuery("#qunit-fixture"),i=function(e){if(document.createEvent){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e[0].dispatchEvent(t)}else e[0].click&&e[0].click()};e.click(function(e){e.preventDefault()}),t.delegate("#foo","click",function(e){var t=e.originalEvent;"boolean"==typeof t.defaultPrevented||"boolean"==typeof t.returnValue||t.getPreventDefault?equal(e.isDefaultPrevented(),!0,"isDefaultPrevented true passed to bubbled event"):ok(!0,"isDefaultPrevented not supported by this browser, test skipped")}),i(e),e.unbind("click"),t.undelegate("click"),e.click(function(){}),t.delegate("#foo","click",function(e){equal(e.isDefaultPrevented(),!1,"isDefaultPrevented false passed to bubbled event")}),i(e),e.unbind("click"),t.undelegate("click")}),test("bind(), iframes",function(){var e=jQuery("#loadediframe").contents();jQuery("div",e).bind("click",function(){ok(!0,"Binding to element inside iframe")}).click().unbind("click")}),test("bind(), trigger change on select",function(){function e(e){equal(e.data,t++,"Event.data is not a global event object")}expect(5);var t=0;jQuery("#form select").each(function(t){jQuery(this).bind("change",t,e)}).trigger("change")}),test("bind(), namespaced events, cloned events",18,function(){var e=jQuery("#firstp");e.bind("custom.test",function(){ok(!1,"Custom event triggered")}),e.bind("click",function(e){ok(!0,"Normal click triggered"),equal(e.type+e.namespace,"click","Check that only click events trigger this fn")}),e.bind("click.test",function(e){var t="click";ok(!0,"Namespaced click triggered"),e.namespace&&(t+="test"),equal(e.type+e.namespace,t,"Check that only click/click.test events trigger this fn")}),e=e.add(e.clone(!0).attr("id","firstp2").insertBefore(e)),e.trigger("click"),e.trigger("click.test"),e.unbind("click.test"),e.trigger("click"),e.unbind(".test"),e.trigger("custom"),jQuery("#nonnodes").contents().bind("tester",function(){equal(this.nodeType,1,"Check node,textnode,comment bind just does real nodes")}).trigger("tester"),jQuery("<a href='#fail' class='test'>test</a>").click(function(){return!1}).appendTo("#qunit-fixture"),ok(jQuery("a.test:first").triggerHandler("click")===!1,"Handler is bound to appendTo'd elements")}),test("bind(), multi-namespaced events",function(){function e(e,i){deepEqual(e,t.shift(),i)}expect(6);var t=["click.test.abc","click.test.abc","click.test","click.test.abc","click.test","custom.test2"];jQuery("#firstp").bind("custom.test",function(){e("custom.test","Custom event triggered")}),jQuery("#firstp").bind("custom.test2",function(){e("custom.test2","Custom event triggered")}),jQuery("#firstp").bind("click.test",function(){e("click.test","Normal click triggered")}),jQuery("#firstp").bind("click.test.abc",function(){e("click.test.abc","Namespaced click triggered")}),jQuery("#firstp").trigger("click.a.test"),jQuery("#firstp").unbind("click.a.test"),jQuery("#firstp").trigger("click.test.abc"),jQuery("#firstp").trigger("click.abc"),jQuery("#firstp").trigger("click.test"),jQuery("#firstp").unbind("click.abc"),jQuery("#firstp").trigger("click"),jQuery("#firstp").unbind(".test"),jQuery("#firstp").trigger("custom")}),test("bind(), with same function",function(){expect(2);var e=0,t=function(){e++};jQuery("#liveHandlerOrder").bind("foo.bar",t).bind("foo.zar",t),jQuery("#liveHandlerOrder").trigger("foo.bar"),equal(e,1,"Verify binding function with multiple namespaces."),jQuery("#liveHandlerOrder").unbind("foo.bar",t).unbind("foo.zar",t),jQuery("#liveHandlerOrder").trigger("foo.bar"),equal(e,1,"Verify that removing events still work.")}),test("bind(), make sure order is maintained",function(){expect(1);var e=jQuery("#firstp"),t=[],i=[];jQuery.each(new Array(100),function(n){e.bind("click",function(){t.push(n)}),i.push(n)}),e.trigger("click"),equal(t.join(","),i.join(","),"Make sure order was maintained."),e.unbind("click")}),test("bind(), with different this object",function(){expect(4);var e={myThis:!0},t={myData:!0},i=function(){equal(this,e,"bind() with different this object")},n=function(i){equal(this,e,"bind() with different this object and data"),equal(i.data,t,"bind() with different this object and data")};jQuery("#firstp").bind("click",jQuery.proxy(i,e)).click().unbind("click",i).bind("click",t,jQuery.proxy(n,e)).click().unbind("click",n),ok(!jQuery._data(jQuery("#firstp")[0],"events"),"Event handler unbound when using different this object and data.")}),test("bind(name, false), unbind(name, false)",function(){expect(3);var e=0;jQuery("#qunit-fixture").bind("click",function(){e++}),jQuery("#ap").trigger("click"),equal(e,1,"Verify that the trigger happened correctly."),e=0,jQuery("#ap").bind("click",!1),jQuery("#ap").trigger("click"),equal(e,0,"Verify that no bubble happened."),e=0,jQuery("#ap").unbind("click",!1),jQuery("#ap").trigger("click"),equal(e,1,"Verify that the trigger happened correctly."),jQuery("#qunit-fixture").unbind("click")}),test("live(name, false), die(name, false)",function(){expect(3);var e=0;jQuery("#qunit-fixture").live("click",function(){e++}),jQuery("#ap").trigger("click"),equal(e,1,"Verify that the trigger happened correctly."),e=0,jQuery("#ap").live("click",!1),jQuery("#ap").trigger("click"),equal(e,0,"Verify that no bubble happened."),e=0,jQuery("#ap").die("click",!1),jQuery("#ap").trigger("click"),equal(e,1,"Verify that the trigger happened correctly."),jQuery("#qunit-fixture").die("click")}),test("delegate(selector, name, false), undelegate(selector, name, false)",function(){expect(3);var e=0;jQuery("#qunit-fixture").delegate("#ap","click",function(){e++}),jQuery("#ap").trigger("click"),equal(e,1,"Verify that the trigger happened correctly."),e=0,jQuery("#ap").delegate("#groups","click",!1),jQuery("#groups").trigger("click"),equal(e,0,"Verify that no bubble happened."),e=0,jQuery("#ap").undelegate("#groups","click",!1),jQuery("#groups").trigger("click"),equal(e,1,"Verify that the trigger happened correctly."),jQuery("#qunit-fixture").undelegate("#ap","click")}),test("bind()/trigger()/unbind() on plain object",function(){expect(7);var e={};jQuery(e).trigger("test"),jQuery(e).unbind("test"),jQuery(e).bind({test:function(){ok(!0,"Custom event run.")},submit:function(){ok(!0,"Custom submit event run.")}});var t=jQuery._data(e,"events");ok(t,"Object has events bound."),equal(e.events,void 0,"Events object on plain objects is not events"),equal(e.test,void 0,"Make sure that test event is not on the plain object."),equal(e.handle,void 0,"Make sure that the event handler is not on the plain object."),jQuery(e).trigger("test"),jQuery(e).trigger("submit"),jQuery(e).unbind("test"),jQuery(e).unbind("submit"),jQuery(e).trigger("test"),jQuery(e).unbind("test"),equal(e&&e[jQuery.expando]&&e[jQuery.expando][jQuery.expando]&&e[jQuery.expando][jQuery.expando].events,void 0,"Make sure events object is removed")}),test("unbind(type)",function(){function e(){ok(!1,t)}expect(1);var t,i=jQuery("#firstp");t="unbind passing function",i.bind("error1",e).unbind("error1",e).triggerHandler("error1"),t="unbind all from event",i.bind("error1",e).unbind("error1").triggerHandler("error1"),t="unbind all",i.bind("error1",e).unbind().triggerHandler("error1"),t="unbind many with function",i.bind("error1 error2",e).unbind("error1 error2",e).trigger("error1").triggerHandler("error2"),t="unbind many",i.bind("error1 error2",e).unbind("error1 error2").trigger("error1").triggerHandler("error2"),t="unbind without a type or handler",i.bind("error1 error2.test",e).unbind().trigger("error1").triggerHandler("error2"),jQuery(document).bind("click",function(){ok(!0,"called handler after selective removal")});var n=function(){};jQuery(document).bind("click",n).unbind("click",n).click().unbind("click")}),test("unbind(eventObject)",function(){function e(e){t=0,i.trigger("foo").triggerHandler("bar"),equal(t,e,"Check the right handlers are triggered")}expect(4);var t,i=jQuery("#firstp");i.bind("foo",function(){t+=1}).bind("foo",function(e){i.unbind(e),t+=2}).bind("bar",function(){t+=4}),e(7),e(5),i.unbind("bar"),e(1),i.unbind(),e(0)}),test("hover() and hover pseudo-event",function(){expect(3);var e=0,t=function(){++e},i=function(){++e};jQuery("#firstp").hover(t,i).mouseenter().mouseleave().unbind("mouseenter",t).unbind("mouseleave",i).hover(t).mouseenter().mouseleave().unbind("mouseenter mouseleave",t).mouseenter().mouseleave(),equal(e,4,"hover handlers fired");var n=0;jQuery("#firstp").on("hovercraft",function(){ok(!1,"hovercraft is full of ills")}).on("click.hover.me.not",function(e){equal(e.handleObj.namespace,"hover.me.not","hover hack doesn't mangle namespaces")}).bind("hover",function(e){"mouseenter"===e.type?n++:"mouseleave"===e.type?n--:ok(!1,"hover pseudo: unknown event type "+e.type)}).trigger("click").trigger("mouseenter").trigger("mouseleave").unbind("hover").trigger("mouseenter"),equal(n,0,"hover pseudo-event")}),test("mouseover triggers mouseenter",function(){expect(1);var e=0,t=jQuery("<a />");t.mouseenter(function(){e++}),t.trigger("mouseover"),equal(e,1,"make sure mouseover triggers a mouseenter"),t.remove()}),test("withinElement implemented with jQuery.contains()",function(){expect(1),jQuery("#qunit-fixture").append('<div id="jc-outer"><div id="jc-inner"></div></div>'),jQuery("#jc-outer").bind("mouseenter mouseleave",function(e){equal(this.id,"jc-outer",this.id+" "+e.type)}).trigger("mouseenter"),jQuery("#jc-inner").trigger("mousenter"),jQuery("#jc-outer").unbind("mouseenter mouseleave").remove(),jQuery("#jc-inner").remove()}),test("mouseenter, mouseleave don't catch exceptions",function(){expect(2);var e=jQuery("#firstp").hover(function(){throw"an Exception"});try{e.mouseenter()}catch(t){equal(t,"an Exception","mouseenter doesn't catch exceptions")}try{e.mouseleave()}catch(t){equal(t,"an Exception","mouseleave doesn't catch exceptions")}}),test("trigger() shortcuts",function(){expect(6);var e=jQuery("<li><a href='#'>Change location</a></li>").prependTo("#firstUL");e.find("a").bind("click",function(){var e=jQuery("spanx",this);return equal(e.length,0,"Context element does not exist, length must be zero"),ok(!e[0],"Context element does not exist, direct access to element must return undefined"),!1}).click(),e.remove(),jQuery("#check1").click(function(){ok(!0,"click event handler for checkbox gets fired twice, see #815")}).click();var t=0;jQuery("#firstp")[0].onclick=function(){t++},jQuery("#firstp").click(),equal(t,1,"Check that click, triggers onclick event handler also");var i=0;jQuery("#simon1")[0].onclick=function(){i++},jQuery("#simon1").click(),equal(i,1,"Check that click, triggers onclick event handler on an a tag also"),e=jQuery("<img />").load(function(){ok(!0,"Trigger the load event, using the shortcut .load() (#2819)")}).load(),e.remove(),jQuery('<xml:namespace ns="urn:schemas-microsoft-com:vml" prefix="v" />').appendTo("head"),jQuery('<v:oval id="oval" style="width:100pt;height:75pt;" fillcolor="red"> </v:oval>').appendTo("#form"),jQuery("#oval").click().keydown()}),test("trigger() bubbling",function(){expect(18);var e=0,t=0,i=0,n=0,r=0,o=0;jQuery(window).bind("click",function(){e++}),jQuery(document).bind("click",function(e){e.target!==document&&t++}),jQuery("html").bind("click",function(){i++}),jQuery("body").bind("click",function(){n++}),jQuery("#qunit-fixture").bind("click",function(){r++}),jQuery("#ap").bind("click",function(){return o++,!1}),jQuery("html").trigger("click"),equal(e,1,"HTML bubble"),equal(t,1,"HTML bubble"),equal(i,1,"HTML bubble"),jQuery("body").trigger("click"),equal(e,2,"Body bubble"),equal(t,2,"Body bubble"),equal(i,2,"Body bubble"),equal(n,1,"Body bubble"),jQuery("#qunit-fixture").trigger("click"),equal(e,3,"Main bubble"),equal(t,3,"Main bubble"),equal(i,3,"Main bubble"),equal(n,2,"Main bubble"),equal(r,1,"Main bubble"),jQuery("#ap").trigger("click"),equal(t,3,"ap bubble"),equal(i,3,"ap bubble"),equal(n,2,"ap bubble"),equal(r,1,"ap bubble"),equal(o,1,"ap bubble"),jQuery(document).trigger("click"),equal(e,4,"doc bubble"),jQuery(document).unbind("click"),jQuery("html, body, #qunit-fixture").unbind("click")}),test("trigger(type, [data], [fn])",function(){expect(16);var e=function(e,t,i,n){return equal(e.type,"click","check passed data"),equal(t,1,"check passed data"),equal(i,"2","check passed data"),equal(n,"abc","check passed data"),"test"},t=jQuery("#firstp");t[0].click=function(){ok(!0,"Native call was triggered")},t.live("mouseenter",function(){ok(!0,"Trigger mouseenter bound by live")}),t.live("mouseleave",function(){ok(!0,"Trigger mouseleave bound by live")}),t.trigger("mouseenter"),t.trigger("mouseleave"),t.die("mouseenter"),t.die("mouseleave"),t.bind("click",e).trigger("click",[1,"2","abc"]),t[0].click=function(){ok(!1,"Native call was triggered")},equal(t.triggerHandler("click",[1,"2","abc"]),"test","Verify handler response");var i,n=!0;try{i=jQuery("#form input:first"),i.get(0).style.display="none",i.trigger("focus")}catch(r){n=!1}ok(n,"Trigger focus on hidden element"),n=!0;try{jQuery("#qunit-fixture table:first").bind("test:test",function(){}).trigger("test:test")}catch(r){n=!1}ok(n,"Trigger on a table with a colon in the even type, see #3533");var o=jQuery("<form action=''></form>").appendTo("body");o.submit(function(){return ok(!0,"Local bind still works."),!1}),o.trigger("submit"),o.unbind("submit"),jQuery(document).submit(function(){return ok(!0,"Make sure bubble works up to document."),!1}),o.trigger("submit"),jQuery(document).unbind("submit"),o.remove()}),test("submit event bubbles on copied forms (#11649)",function(){function e(e){e.preventDefault()}function t(){return ok(!0,"Make sure submit event bubbles up."),!1}expect(3);var i,n,r=jQuery("#testForm"),o=jQuery("#qunit-fixture"),c=jQuery("<div/>").appendTo(o);o.on("submit","form",t),r.on("submit",e).find("input[name=sub1]").click(),i=r.clone(!0,!0).removeAttr("id"),n=jQuery(o.html()).filter("#testForm").removeAttr("id"),c.append(i,n),c.find("form").on("submit",e).find("input[name=sub1]").click(),c.remove(),o.off("submit","form",t),r.off("submit",e)}),test("change event bubbles on copied forms (#11796)",function(){function e(){return ok(!0,"Make sure change event bubbles up."),!1}expect(3);var t,i,n=jQuery("#form"),r=jQuery("#qunit-fixture"),o=jQuery("<div/>").appendTo(r);r.on("change","form",e),n.find("select[name=select1]").val("1").change(),t=n.clone(!0,!0).removeAttr("id"),i=jQuery(r.html()).filter("#form").removeAttr("id"),o.append(t,i),o.find("form select[name=select1]").val("2").change(),o.remove(),r.off("change","form",e)}),test("trigger(eventObject, [data], [fn])",function(){function e(){ok(!1,"This assertion shouldn't be reached")}expect(28);var t=jQuery("<div id='par' />").appendTo("body"),i=jQuery("<p id='child'>foo</p>").appendTo(t);t.get(0).style.display="none";var n=jQuery.Event("noNew");ok(n!=window,"Instantiate jQuery.Event without the 'new' keyword"),equal(n.type,"noNew","Verify its type"),equal(n.isDefaultPrevented(),!1,"Verify isDefaultPrevented"),equal(n.isPropagationStopped(),!1,"Verify isPropagationStopped"),equal(n.isImmediatePropagationStopped(),!1,"Verify isImmediatePropagationStopped"),n.preventDefault(),equal(n.isDefaultPrevented(),!0,"Verify isDefaultPrevented"),n.stopPropagation(),equal(n.isPropagationStopped(),!0,"Verify isPropagationStopped"),n.isPropagationStopped=function(){return!1},n.stopImmediatePropagation(),equal(n.isPropagationStopped(),!0,"Verify isPropagationStopped"),equal(n.isImmediatePropagationStopped(),!0,"Verify isPropagationStopped"),t.bind("foo",function(e){equal(e.type,"foo","Verify event type when passed passing an event object"),equal(e.target.id,"child","Verify event.target when passed passing an event object"),equal(e.currentTarget.id,"par","Verify event.currentTarget when passed passing an event object"),equal(e.secret,"boo!","Verify event object's custom attribute when passed passing an event object")}),n=new jQuery.Event("foo"),n.secret="boo!",i.trigger(n),i.trigger({type:"foo",secret:"boo!"}),t.unbind(),t.bind("foo",e),i.bind("foo",function(e,t,i,n){return equal(arguments.length,4,"Check arguments length"),equal(t,1,"Check first custom argument"),equal(i,2,"Check second custom argument"),equal(n,3,"Check third custom argument"),equal(e.isDefaultPrevented(),!1,"Verify isDefaultPrevented"),equal(e.isPropagationStopped(),!1,"Verify isPropagationStopped"),equal(e.isImmediatePropagationStopped(),!1,"Verify isImmediatePropagationStopped"),e.stopImmediatePropagation(),"result"}),n=new jQuery.Event("foo"),i.trigger(n,[1,2,3]).unbind(),equal(n.result,"result","Check event.result attribute"),i.triggerHandler("foo"),i.unbind(),t.unbind().remove(),n=jQuery.Event("zowie"),jQuery(document).triggerHandler(n),equal(n.type,"zowie","Verify its type"),equal(n.isPropagationStopped(),!1,"propagation not stopped"),equal(n.isDefaultPrevented(),!1,"default not prevented")}),test(".trigger() bubbling on disconnected elements (#10489)",function(){expect(2),jQuery(window).on("click",function(){ok(!1,"click fired on window")}),jQuery("<div><p>hi</p></div>").on("click",function(){ok(!0,"click fired on div")}).find("p").on("click",function(){ok(!0,"click fired on p")}).click().off("click").end().off("click").remove(),jQuery(window).off("click")}),test(".trigger() doesn't bubble load event (#10717)",function(){expect(1),jQuery(window).on("load",function(){ok(!1,"load fired on window")}),jQuery('<img src="index.html" />').appendTo("body").on("load",function(){ok(!0,"load fired on img")}).trigger("load").remove(),jQuery(window).off("load")}),test("Delegated events in SVG (#10791)",function(){expect(2);var e=jQuery('<svg height="1" version="1.1" width="1" xmlns="http://www.w3.org/2000/svg"><rect class="svg-by-class" x="10" y="20" width="100" height="60" r="10" rx="10" ry="10"></rect><rect id="svg-by-id" x="10" y="20" width="100" height="60" r="10" rx="10" ry="10"></rect></svg>').appendTo("body");jQuery("body").on("click","#svg-by-id",function(){ok(!0,"delegated id selector")}).on("click","[class~='svg-by-class']",function(){ok(!0,"delegated class selector")}).find("#svg-by-id, [class~='svg-by-class']").trigger("click").end().off("click"),e.remove()}),test("Delegated events in forms (#10844; #11145; #8165; #11382, #11764)",function(){expect(5);var e=jQuery('<form id="myform"><input type="text" name="id" value="secret agent man" /></form>').on("submit",function(e){e.preventDefault()}).appendTo("body");jQuery("body").on("submit","#myform",function(){ok(!0,"delegated id selector with aliased id")}).find("#myform").trigger("submit").end().off("submit"),e.append('<input type="text" name="disabled" value="differently abled" />'),jQuery("body").on("submit","#myform",function(){ok(!0,"delegated id selector with aliased disabled")}).find("#myform").trigger("submit").end().off("submit"),e.append('<button id="nestyDisabledBtn"><span>Zing</span></button>').on("click","#nestyDisabledBtn",function(){ok(!0,"click on enabled/disabled button with nesty elements")}).on("mouseover","#nestyDisabledBtn",function(){ok(!0,"mouse on enabled/disabled button with nesty elements")}).find("span").trigger("click").trigger("mouseover").end().find("#nestyDisabledBtn").prop("disabled",!0).end().find("span").trigger("click").trigger("mouseover").end().off("click"),e.remove()}),test("Submit event can be stopped (#11049)",function(){expect(1);var e=jQuery('<form id="myform"><input type="text" name="sue" value="bawls" /><input type="submit" /></form>').appendTo("body");jQuery("body").on("submit",function(){return ok(!0,"submit bubbled on first handler"),!1}).find("#myform input[type=submit]").each(function(){this.click()}).end().on("submit",function(){return ok(!1,"submit bubbled on second handler"),!1}).find("#myform input[type=submit]").each(function(){jQuery(this.form).on("submit",function(e){e.preventDefault(),e.stopPropagation()}),this.click()}).end().off("submit"),e.remove()}),test("on(beforeunload) creates/deletes window property instead of adding/removing event listener",function(){expect(3),equal(window.onbeforeunload,null,"window property is null/undefined up until now");var e=function(){};jQuery(window).on("beforeunload",e),equal(typeof window.onbeforeunload,"function","window property is set to a function"),jQuery(window).off("beforeunload",e),equal(window.onbeforeunload,null,"window property has been unset to null/undefined")}),test("jQuery.Event( type, props )",function(){expect(5);var e=jQuery.Event("keydown",{keyCode:64}),t=function(e){ok("keyCode"in e,"Special property 'keyCode' exists"),equal(e.keyCode,64,"event.keyCode has explicit value '64'")};equal(e.type,"keydown","Verify type"),equal(jQuery.inArray("type",jQuery.event.props),-1,"'type' property not in props (#10375)"),ok("keyCode"in e,"Special 'keyCode' property exists"),jQuery("body").bind("keydown",t).trigger(e),jQuery("body").unbind("keydown")}),test("jQuery.Event.currentTarget",function(){expect(2),jQuery("<div><p><button>shiny</button></p></div>").on("click","p",function(e){equal(e.currentTarget,this,"Check delegated currentTarget on event")}).find("button").on("click",function(e){equal(e.currentTarget,this,"Check currentTarget on event")}).click().off("click").end().off("click")}),test("toggle(Function, Function, ...)",function(){expect(16);var e=0,t=function(){e++},i=function(){e--},n=function(e){e.preventDefault()},r=jQuery("#mark");r.click(n).click().toggle(t,i).click().click().click().click().click(),equal(e,1,"Check for toggle(fn, fn)"),jQuery("#firstp").toggle(function(){equal(arguments.length,4,"toggle correctly passes through additional triggered arguments, see #1701")},function(){}).trigger("click",[1,2,3]);var o=0;jQuery("#simon1").one("click",function(){return ok(!0,"Execute event only once"),jQuery(this).toggle(function(){equal(o++,0,"toggle(Function,Function) assigned from within one('xxx'), see #1054")},function(){equal(o,1,"toggle(Function,Function) assigned from within one('xxx'), see #1054")}),!1}).click().click().click();var c=0,a=[function(){c=1},function(){c=2},function(){c=3}],u=jQuery("<div>&nbsp;</div>").toggle(a[0],a[1],a[2]);u.click(),equal(c,1,"Trying toggle with 3 functions, attempt 1 yields 1"),u.click(),equal(c,2,"Trying toggle with 3 functions, attempt 2 yields 2"),u.click(),equal(c,3,"Trying toggle with 3 functions, attempt 3 yields 3"),u.click(),equal(c,1,"Trying toggle with 3 functions, attempt 4 yields 1"),u.click(),equal(c,2,"Trying toggle with 3 functions, attempt 5 yields 2"),u.unbind("click",a[0]);var d=jQuery._data(u[0],"events");ok(!d,"Unbinding one function from toggle unbinds them all"),u.remove();var l=[],s=[];u=jQuery("<div/>"),u.toggle(function(){l.push(1)},function(){l.push(2)}),u.click(),deepEqual(l,[1],"Check that a click worked."),u.toggle(function(){s.push(1)},function(){s.push(2)}),u.click(),deepEqual(l,[1,2],"Check that a click worked with a second toggle."),deepEqual(s,[1],"Check that a click worked with a second toggle."),u.click(),deepEqual(l,[1,2,1],"Check that a click worked with a second toggle, second click."),deepEqual(s,[1,2],"Check that a click worked with a second toggle, second click."),u.remove()}),test(".live()/.die()",function(){function e(){return l++,!1}function t(){f++}expect(66);var i=0,n=0,r=0,o=0;jQuery("div").live("submit",function(){return i++,!1}),jQuery("div").live("click",function(){n++}),jQuery("div#nothiddendiv").live("click",function(){r++}),jQuery("div#nothiddendivchild").live("click",function(){o++}),jQuery("body").trigger("click"),equal(i,0,"Click on body"),equal(n,0,"Click on body"),equal(r,0,"Click on body"),equal(o,0,"Click on body"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendiv").trigger("click"),equal(i,0,"Click on div"),equal(n,1,"Click on div"),equal(r,1,"Click on div"),equal(o,0,"Click on div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"Click on inner div"),equal(n,2,"Click on inner div"),equal(r,1,"Click on inner div"),equal(o,1,"Click on inner div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").trigger("submit"),equal(i,1,"Submit on div"),equal(n,0,"Submit on div"),equal(r,0,"Submit on div"),equal(o,0,"Submit on div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"die Click on inner div"),equal(n,2,"die Click on inner div"),equal(r,1,"die Click on inner div"),equal(o,1,"die Click on inner div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").die("click"),jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"die Click on inner div"),equal(n,2,"die Click on inner div"),equal(r,1,"die Click on inner div"),equal(o,0,"die Click on inner div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendiv").trigger("click"),equal(i,0,"die Click on inner div"),equal(n,1,"die Click on inner div"),equal(r,1,"die Click on inner div"),equal(o,0,"die Click on inner div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").live("click",function(e){o++,e.stopPropagation()}),jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"stopPropagation Click on inner div"),equal(n,1,"stopPropagation Click on inner div"),equal(r,0,"stopPropagation Click on inner div"),equal(o,1,"stopPropagation Click on inner div"),i=0,n=0,r=0,o=0;var c=jQuery.Event("click");c.button=1,jQuery("div#nothiddendiv").trigger(c),equal(r,0,"live secondary click"),jQuery("div#nothiddendivchild").die("click"),jQuery("div#nothiddendiv").die("click"),jQuery("div").die("click"),jQuery("div").die("submit");var a=0,u=jQuery("#qunit-fixture")[0];jQuery("#foo",u).live("click",function(){a++}),jQuery("div").trigger("click"),jQuery("#foo").trigger("click"),jQuery("#qunit-fixture").trigger("click"),jQuery("body").trigger("click"),equal(a,2,"live with a context"),jQuery("#foo",u).die("click"),jQuery("#foo").trigger("click"),equal(a,2,"die with a context"),jQuery("#foo").live("click",!0,function(e){equal(e.data,!0,"live with event data")}),jQuery("#foo").trigger("click").die("click"),jQuery("#foo").live("click",function(e,t){equal(t,!0,"live with trigger data")}),jQuery("#foo").trigger("click",!0).die("click"),jQuery("#foo").live("click",jQuery.proxy(function(){equal(this.foo,"bar","live with event scope")},{foo:"bar"})),jQuery("#foo").trigger("click").die("click"),jQuery("#foo").live("click",!0,jQuery.proxy(function(e,t){equal(e.data,!0,"live with with different this object, event data, and trigger data"),equal(this.foo,"bar","live with with different this object, event data, and trigger data"),equal(t,!0,"live with with different this object, event data, and trigger data")
},{foo:"bar"})),jQuery("#foo").trigger("click",!0).die("click"),jQuery("#anchor2").live("click",function(){return!1});var d=window.location.hash;jQuery("#anchor2").trigger("click"),equal(window.location.hash,d,"return false worked"),jQuery("#anchor2").die("click"),jQuery("#anchor2").live("click",function(e){e.preventDefault()}),d=window.location.hash,jQuery("#anchor2").trigger("click"),equal(window.location.hash,d,"e.preventDefault() worked"),jQuery("#anchor2").die("click");var l=0;jQuery("#nothiddendiv").live("click",e),jQuery("#anchor2").live("click",e),jQuery("#nothiddendiv").trigger("click"),equal(l,1,"Verify that only one click occurred."),l=0,jQuery("#anchor2").trigger("click"),equal(l,1,"Verify that only one click occurred."),jQuery("#anchor2").die("click",e),l=0,jQuery("#nothiddendiv").trigger("click"),equal(l,1,"Verify that only one click occurred."),l=0,jQuery("#anchor2").trigger("click"),equal(l,0,"Verify that no click occurred."),jQuery("#nothiddendiv").live("foo",e),jQuery("#nothiddendiv").die("click",e),l=0,jQuery("#nothiddendiv").trigger("click"),equal(l,0,"Verify that no click occurred."),l=0,jQuery("#nothiddendiv").trigger("foo"),equal(l,1,"Verify that one foo occurred."),jQuery("#nothiddendiv").die("foo",e);{var s=0;jQuery("#nothiddendivchild").html("<span></span>").get(0)}jQuery("#nothiddendivchild").live("click",function(){jQuery("#nothiddendivchild").html("")}),jQuery("#nothiddendivchild").live("click",function(e){e.target&&s++}),jQuery("#nothiddendiv span").click(),equal(jQuery("#nothiddendiv span").length,0,"Verify that first handler occurred and modified the DOM."),equal(s,1,"Verify that second handler occurred even with nuked target."),jQuery("#nothiddendivchild").die("click");var g=0,f=0;jQuery("span#liveSpan1 a").live("click",function(){return g++,!1}),jQuery("span#liveSpan1").live("click",function(){f++}),jQuery("span#liveSpan1 a").click(),equal(g,1,"Verify that only one first handler occurred."),equal(f,0,"Verify that second handler doesn't."),jQuery("span#liveSpan2").live("click",function(){f++}),jQuery("span#liveSpan2 a").live("click",function(){return g++,!1}),g=0,f=0,jQuery("span#liveSpan2 a").click(),equal(g,1,"Verify that only one first handler occurred."),equal(f,0,"Verify that second handler doesn't."),jQuery("span#liveSpan1 a").die("click"),jQuery("span#liveSpan1").die("click"),jQuery("span#liveSpan2 a").die("click"),jQuery("span#liveSpan2").die("click"),jQuery("span#liveSpan1").live("click",function(e){equal(this.id,"liveSpan1","Check the this within a live handler"),equal(e.currentTarget.id,"liveSpan1","Check the event.currentTarget within a live handler"),equal(e.delegateTarget,document,"Check the event.delegateTarget within a live handler"),equal(e.target.nodeName.toUpperCase(),"A","Check the event.target within a live handler")}),jQuery("span#liveSpan1 a").click(),jQuery("span#liveSpan1").die("click"),f=0,jQuery("#nothiddendiv div").live("click",function(){f++}),jQuery("#nothiddendiv div").live("click",t),jQuery("#nothiddendiv div").live("mouseover",function(){f++}),equal(f,0,"No clicks, deep selector."),f=0,jQuery("#nothiddendivchild").trigger("click"),equal(f,2,"Click, deep selector."),f=0,jQuery("#nothiddendivchild").trigger("mouseover"),equal(f,1,"Mouseover, deep selector."),jQuery("#nothiddendiv div").die("mouseover"),f=0,jQuery("#nothiddendivchild").trigger("click"),equal(f,2,"Click, deep selector."),f=0,jQuery("#nothiddendivchild").trigger("mouseover"),equal(f,0,"Mouseover, deep selector."),jQuery("#nothiddendiv div").die("click",t),f=0,jQuery("#nothiddendivchild").trigger("click"),equal(f,1,"Click, deep selector."),jQuery("#nothiddendiv div").die("click"),jQuery("#nothiddendiv div").live("blur",function(){ok(!0,"Live div trigger blur.")}).trigger("blur").die("blur")}),test("die all bound events",function(){expect(1);var e=0,t=jQuery("div#nothiddendivchild");t.live("click submit",function(){e++}),t.die(),t.trigger("click"),t.trigger("submit"),equal(e,0,"Make sure no events were triggered.")}),test("live with multiple events",function(){expect(1);var e=0,t=jQuery("div#nothiddendivchild");t.live("click submit",function(){e++}),t.trigger("click"),t.trigger("submit"),equal(e,2,"Make sure both the click and submit were triggered."),t.die()}),test("live with namespaces",function(){expect(15);var e=0,t=0;jQuery("#liveSpan1").live("foo.bar",function(t){equal(t.namespace,"bar","namespace is bar"),e++}),jQuery("#liveSpan1").live("foo.zed",function(e){equal(e.namespace,"zed","namespace is zed"),t++}),jQuery("#liveSpan1").trigger("foo.bar"),equal(e,1,"Got live foo.bar"),equal(t,0,"Got live foo.bar"),e=0,t=0,jQuery("#liveSpan1").trigger("foo.zed"),equal(e,0,"Got live foo.zed"),equal(t,1,"Got live foo.zed"),e=0,t=0,jQuery("#liveSpan1").die("foo.zed"),jQuery("#liveSpan1").trigger("foo.bar"),equal(e,1,"Got live foo.bar after dieing foo.zed"),equal(t,0,"Got live foo.bar after dieing foo.zed"),e=0,t=0,jQuery("#liveSpan1").trigger("foo.zed"),equal(e,0,"Got live foo.zed"),equal(t,0,"Got live foo.zed"),jQuery("#liveSpan1").die("foo.bar"),e=0,t=0,jQuery("#liveSpan1").trigger("foo.bar"),equal(e,0,"Did not respond to foo.bar after dieing it"),equal(t,0,"Did not respond to foo.bar after dieing it"),jQuery("#liveSpan1").trigger("foo.zed"),equal(e,0,"Did not trigger foo.zed again"),equal(t,0,"Did not trigger foo.zed again")}),test("live with change",function(){expect(8);var e=0,t=0,i=jQuery("select[name='S1']");i.live("change",function(){e++});var n=jQuery("#check2"),r=function(){t++};n.live("change",r),e=0,i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,1,"Change on click."),e=0,i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,1,"Change on keyup."),n.trigger("change"),equal(t,1,"Change on checkbox.");var o=jQuery("#name"),c=0,a=o.val();o.live("change",function(){c++}),o.val(a+"foo"),o.trigger("change"),equal(c,1,"Change on text input."),o.val(a),o.die("change");var u=jQuery("#name"),d=0,l=u.val();u.live("change",function(){d++}),u.val(l+"foo"),u.trigger("change"),equal(d,1,"Change on password input."),u.val(l),u.die("change"),e=0,i.die("change"),i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,0,"Die on click works."),e=0,i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,0,"Die on keyup works."),n.die("change",r),n.trigger("change"),equal(t,1,"Die on checkbox.")}),test("live with submit",function(){expect(7);var e=0,t=0;jQuery("#testForm").live("submit",function(t){e++,t.preventDefault()}),jQuery("body").live("submit",function(e){t++,e.preventDefault()}),jQuery("#testForm input[name=sub1]").submit(),equal(e,1,"Verify form submit."),equal(t,1,"Verify body submit."),jQuery("#testForm input[name=sub1]").live("click",function(){ok(!0,"cancelling submit still calls click handler")}),jQuery("#testForm input[name=sub1]")[0].click(),equal(e,2,"Verify form submit."),equal(t,2,"Verify body submit."),jQuery("#testForm button[name=sub4]")[0].click(),equal(e,3,"Verify form submit."),equal(t,3,"Verify body submit."),jQuery("#testForm").die("submit"),jQuery("#testForm input[name=sub1]").die("click"),jQuery("body").die("submit")}),test("live with special events",function(){expect(13),jQuery.event.special.foo={setup:function(){ok(!0,"Setup run.")},teardown:function(){ok(!0,"Teardown run.")},add:function(){ok(!0,"Add run.")},remove:function(){ok(!0,"Remove run.")},_default:function(e,t){ok("foo"===e.type&&42==t,"Default run with correct args.")}},jQuery("#liveSpan1").live("foo.a",function(){ok(!0,"Handler 1 run.")}),jQuery("#liveSpan1").live("foo.b",function(){ok(!0,"Handler 2 run.")}),jQuery("#liveSpan1").trigger("foo",42),jQuery("#liveSpan1").trigger("foo.a",42),jQuery("#liveSpan1").die("foo.a"),jQuery("#liveSpan1").trigger("foo",42),jQuery("#liveSpan1").die("foo"),delete jQuery.event.special.foo}),test(".delegate()/.undelegate()",function(){function e(){return d++,!1}function t(){g++}expect(65);var i=0,n=0,r=0,o=0;jQuery("#body").delegate("div","submit",function(){return i++,!1}),jQuery("#body").delegate("div","click",function(){n++}),jQuery("#body").delegate("div#nothiddendiv","click",function(){r++}),jQuery("#body").delegate("div#nothiddendivchild","click",function(){o++}),jQuery("body").trigger("click"),equal(i,0,"Click on body"),equal(n,0,"Click on body"),equal(r,0,"Click on body"),equal(o,0,"Click on body"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendiv").trigger("click"),equal(i,0,"Click on div"),equal(n,1,"Click on div"),equal(r,1,"Click on div"),equal(o,0,"Click on div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"Click on inner div"),equal(n,2,"Click on inner div"),equal(r,1,"Click on inner div"),equal(o,1,"Click on inner div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").trigger("submit"),equal(i,1,"Submit on div"),equal(n,0,"Submit on div"),equal(r,0,"Submit on div"),equal(o,0,"Submit on div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"undelegate Click on inner div"),equal(n,2,"undelegate Click on inner div"),equal(r,1,"undelegate Click on inner div"),equal(o,1,"undelegate Click on inner div"),i=0,n=0,r=0,o=0,jQuery("#body").undelegate("div#nothiddendivchild","click"),jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"undelegate Click on inner div"),equal(n,2,"undelegate Click on inner div"),equal(r,1,"undelegate Click on inner div"),equal(o,0,"undelegate Click on inner div"),i=0,n=0,r=0,o=0,jQuery("div#nothiddendiv").trigger("click"),equal(i,0,"undelegate Click on inner div"),equal(n,1,"undelegate Click on inner div"),equal(r,1,"undelegate Click on inner div"),equal(o,0,"undelegate Click on inner div"),i=0,n=0,r=0,o=0,jQuery("#body").delegate("div#nothiddendivchild","click",function(e){o++,e.stopPropagation()}),jQuery("div#nothiddendivchild").trigger("click"),equal(i,0,"stopPropagation Click on inner div"),equal(n,1,"stopPropagation Click on inner div"),equal(r,0,"stopPropagation Click on inner div"),equal(o,1,"stopPropagation Click on inner div"),i=0,n=0,r=0,o=0;var c=jQuery.Event("click");c.button=1,jQuery("div#nothiddendiv").trigger(c),equal(r,0,"delegate secondary click"),jQuery("#body").undelegate("div#nothiddendivchild","click"),jQuery("#body").undelegate("div#nothiddendiv","click"),jQuery("#body").undelegate("div","click"),jQuery("#body").undelegate("div","submit");{var a=0;jQuery("#qunit-fixture")[0]}jQuery("#qunit-fixture").delegate("#foo","click",function(){a++}),jQuery("div").trigger("click"),jQuery("#foo").trigger("click"),jQuery("#qunit-fixture").trigger("click"),jQuery("body").trigger("click"),equal(a,2,"delegate with a context"),jQuery("#qunit-fixture").undelegate("#foo","click"),jQuery("#foo").trigger("click"),equal(a,2,"undelegate with a context"),jQuery("#body").delegate("#foo","click",!0,function(e){equal(e.data,!0,"delegate with event data")}),jQuery("#foo").trigger("click"),jQuery("#body").undelegate("#foo","click"),jQuery("#body").delegate("#foo","click",function(e,t){equal(t,!0,"delegate with trigger data")}),jQuery("#foo").trigger("click",!0),jQuery("#body").undelegate("#foo","click"),jQuery("#body").delegate("#foo","click",jQuery.proxy(function(){equal(this.foo,"bar","delegate with event scope")},{foo:"bar"})),jQuery("#foo").trigger("click"),jQuery("#body").undelegate("#foo","click"),jQuery("#body").delegate("#foo","click",!0,jQuery.proxy(function(e,t){equal(e.data,!0,"delegate with with different this object, event data, and trigger data"),equal(this.foo,"bar","delegate with with different this object, event data, and trigger data"),equal(t,!0,"delegate with with different this object, event data, and trigger data")},{foo:"bar"})),jQuery("#foo").trigger("click",!0),jQuery("#body").undelegate("#foo","click"),jQuery("#body").delegate("#anchor2","click",function(){return!1});var u=window.location.hash;jQuery("#anchor2").trigger("click"),equal(window.location.hash,u,"return false worked"),jQuery("#body").undelegate("#anchor2","click"),jQuery("#body").delegate("#anchor2","click",function(e){e.preventDefault()}),u=window.location.hash,jQuery("#anchor2").trigger("click"),equal(window.location.hash,u,"e.preventDefault() worked"),jQuery("#body").undelegate("#anchor2","click");var d=0;jQuery("#body").delegate("#nothiddendiv","click",e),jQuery("#body").delegate("#anchor2","click",e),jQuery("#nothiddendiv").trigger("click"),equal(d,1,"Verify that only one click occurred."),d=0,jQuery("#anchor2").trigger("click"),equal(d,1,"Verify that only one click occurred."),jQuery("#body").undelegate("#anchor2","click",e),d=0,jQuery("#nothiddendiv").trigger("click"),equal(d,1,"Verify that only one click occurred."),d=0,jQuery("#anchor2").trigger("click"),equal(d,0,"Verify that no click occurred."),jQuery("#body").delegate("#nothiddendiv","foo",e),jQuery("#body").undelegate("#nothiddendiv","click",e),d=0,jQuery("#nothiddendiv").trigger("click"),equal(d,0,"Verify that no click occurred."),d=0,jQuery("#nothiddendiv").trigger("foo"),equal(d,1,"Verify that one foo occurred."),jQuery("#body").undelegate("#nothiddendiv","foo",e);{var l=0;jQuery("#nothiddendivchild").html("<span></span>").get(0)}jQuery("#body").delegate("#nothiddendivchild","click",function(){jQuery("#nothiddendivchild").html("")}),jQuery("#body").delegate("#nothiddendivchild","click",function(e){e.target&&l++}),jQuery("#nothiddendiv span").click(),equal(jQuery("#nothiddendiv span").length,0,"Verify that first handler occurred and modified the DOM."),equal(l,1,"Verify that second handler occurred even with nuked target."),jQuery("#body").undelegate("#nothiddendivchild","click");var s=0,g=0;jQuery("#body").delegate("span#liveSpan1 a","click",function(){return s++,!1}),jQuery("#body").delegate("span#liveSpan1","click",function(){g++}),jQuery("span#liveSpan1 a").click(),equal(s,1,"Verify that only one first handler occurred."),equal(g,0,"Verify that second handler doesn't."),jQuery("#body").delegate("span#liveSpan2","click",function(){g++}),jQuery("#body").delegate("span#liveSpan2 a","click",function(){return s++,!1}),s=0,g=0,jQuery("span#liveSpan2 a").click(),equal(s,1,"Verify that only one first handler occurred."),equal(g,0,"Verify that second handler doesn't."),jQuery("#body").undelegate("click"),jQuery("#body").delegate("span#liveSpan1","click",function(e){equal(this.id,"liveSpan1","Check the this within a delegate handler"),equal(e.currentTarget.id,"liveSpan1","Check the event.currentTarget within a delegate handler"),equal(e.delegateTarget,document.body,"Check the event.delegateTarget within a delegate handler"),equal(e.target.nodeName.toUpperCase(),"A","Check the event.target within a delegate handler")}),jQuery("span#liveSpan1 a").click(),jQuery("#body").undelegate("span#liveSpan1","click"),g=0,jQuery("#body").delegate("#nothiddendiv div","click",function(){g++}),jQuery("#body").delegate("#nothiddendiv div","click",t),jQuery("#body").delegate("#nothiddendiv div","mouseover",function(){g++}),equal(g,0,"No clicks, deep selector."),g=0,jQuery("#nothiddendivchild").trigger("click"),equal(g,2,"Click, deep selector."),g=0,jQuery("#nothiddendivchild").trigger("mouseover"),equal(g,1,"Mouseover, deep selector."),jQuery("#body").undelegate("#nothiddendiv div","mouseover"),g=0,jQuery("#nothiddendivchild").trigger("click"),equal(g,2,"Click, deep selector."),g=0,jQuery("#nothiddendivchild").trigger("mouseover"),equal(g,0,"Mouseover, deep selector."),jQuery("#body").undelegate("#nothiddendiv div","click",t),g=0,jQuery("#nothiddendivchild").trigger("click"),equal(g,1,"Click, deep selector."),jQuery("#body").undelegate("#nothiddendiv div","click")}),test("jQuery.off using dispatched jQuery.Event",function(){expect(1);var e=jQuery('<p><a href="#">target</a></p>'),t=0;e.on("click.name","a",function(e){equal(++t,1,"event called once before removal"),jQuery().off(e)}).find("a").click().click().end().remove()}),test("delegated event with delegateTarget-relative selector",function(){expect(3);var e=jQuery('<ul><li><a id="a0"></a><ul id="ul0"><li class=test><a id="a0_0"></a></li><li><a id="a0_1"></a></li></ul></li></ul>').appendTo("#qunit-fixture");e.on("click",">li>a",function(){ok("a0"===this.id,"child li was clicked")}).find("#ul0").on("click","li:first>a",function(){ok("a0_0"===this.id,"first li under #u10 was clicked")}).end().find("a").click().end().find("#ul0").off(),e=e.wrap("<div />").parent(),e.find("#ul0").on("click","div li a",function(){ok(!1,"div is ABOVE the delegation point!")}).on("click","ul a",function(){ok(!1,"ul is the delegation point!")}).on("click","li.test a",function(){ok(!0,"li.test is below the delegation point.")}).find("#a0_0").click(),e.remove()}),test("stopPropagation() stops directly-bound events on delegated target",function(){expect(1);var e=jQuery('<div><p><a href="#">target</a></p></div>');e.on("click",function(){ok(!1,"directly-bound event on delegate target was called")}).on("click","a",function(e){e.stopPropagation(),ok(!0,"delegated handler was called")}).find("a").click().end().remove()}),test("undelegate all bound events",function(){expect(2);var e=0,t=0,i=jQuery("#body");i.delegate("div#nothiddendivchild","click submit",function(){e++}),i.bind("click",function(){t++}),i.undelegate(),jQuery("div#nothiddendivchild").trigger("click"),jQuery("div#nothiddendivchild").trigger("submit"),equal(e,0,"Make sure no events were triggered."),i.trigger("click"),equal(t,2,"Make sure delegated and directly bound event occurred."),i.unbind("click")}),test("delegate with multiple events",function(){expect(1);var e=0,t=jQuery("#body");t.delegate("div#nothiddendivchild","click submit",function(){e++}),jQuery("div#nothiddendivchild").trigger("click"),jQuery("div#nothiddendivchild").trigger("submit"),equal(e,2,"Make sure both the click and submit were triggered."),jQuery("#body").undelegate()}),test("delegate with change",function(){expect(8);var e=0,t=0,i=jQuery("select[name='S1']");jQuery("#body").delegate("select[name='S1']","change",function(){e++});var n=jQuery("#check2"),r=function(){t++};jQuery("#body").delegate("#check2","change",r),e=0,i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,1,"Change on click."),e=0,i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,1,"Change on keyup."),n.trigger("change"),equal(t,1,"Change on checkbox.");var o=jQuery("#name"),c=0,a=o.val();jQuery("#body").delegate("#name","change",function(){c++}),o.val(a+"foo"),o.trigger("change"),equal(c,1,"Change on text input."),o.val(a),jQuery("#body").die("change");var u=jQuery("#name"),d=0,l=u.val();jQuery("#body").delegate("#name","change",function(){d++}),u.val(l+"foo"),u.trigger("change"),equal(d,1,"Change on password input."),u.val(l),jQuery("#body").undelegate("#name","change"),e=0,jQuery("#body").undelegate("select[name='S1']","change"),i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,0,"Die on click works."),e=0,i[0].selectedIndex=i[0].selectedIndex?0:1,i.trigger("change"),equal(e,0,"Die on keyup works."),jQuery("#body").undelegate("#check2","change",r),n.trigger("change"),equal(t,1,"Die on checkbox.")}),test("delegate with submit",function(){var e=0,t=0;jQuery("#body").delegate("#testForm","submit",function(t){e++,t.preventDefault()}),jQuery(document).delegate("body","submit",function(e){t++,e.preventDefault()}),jQuery("#testForm input[name=sub1]").submit(),equal(e,1,"Verify form submit."),equal(t,1,"Verify body submit."),jQuery("#body").undelegate(),jQuery(document).undelegate()}),test("undelegate() with only namespaces",function(){expect(2);var e=jQuery("#liveHandlerOrder"),t=0;e.delegate("a","click.ns",function(){t++}),jQuery("a",e).eq(0).trigger("click.ns"),equal(t,1,"delegated click.ns"),e.undelegate(".ns"),jQuery("a",e).eq(1).trigger("click.ns"),equal(t,1,"no more .ns after undelegate")}),test("Non DOM element events",function(){expect(1);var e={};jQuery(e).bind("nonelementobj",function(){ok(!0,"Event on non-DOM object triggered")}),jQuery(e).trigger("nonelementobj")}),test("inline handler returning false stops default",function(){expect(1);var e=jQuery('<div><a href="#" onclick="return false">x</a></div>');e.click(function(e){return ok(e.isDefaultPrevented(),"inline handler prevented default"),!1}),e.find("a").click(),e.off("click")}),test("window resize",function(){expect(2),jQuery(window).unbind(),jQuery(window).bind("resize",function(){ok(!0,"Resize event fired.")}).resize().unbind("resize"),ok(!jQuery._data(window,"__events__"),"Make sure all the events are gone.")}),test("focusin bubbles",function(){expect(2);var e=jQuery("<input type='text' />").prependTo("body"),t=0;e[0].focus(),jQuery("body").bind("focusin.focusinBubblesTest",function(){equal(1,t++,"focusin on the body second")}),e.bind("focusin.focusinBubblesTest",function(){equal(0,t++,"focusin on the element first")}),t=0,e.trigger("focus"),e.remove(),jQuery("body").unbind("focusin.focusinBubblesTest")}),test("custom events with colons (#3533, #8272)",function(){expect(1);var e=jQuery("<table><tr><td>trigger</td></tr></table>").appendTo("body");try{e.trigger("back:forth"),ok(!0,"colon events don't throw")}catch(t){ok(!1,"colon events die")}e.remove()}),test(".on and .off",function(){expect(9);var e,t,i=jQuery('<div id="onandoff"><p>on<b>and</b>off</p><div>worked<em>or</em>borked?</div></div>').appendTo("body");jQuery("#onandoff").on("whip",function(){ok(!0,"whipped it good")}).trigger("whip").off(),e=0,jQuery("#onandoff b").on("click",5,function(t,i){e+=t.data+(i||9)}).one("click",7,function(t,i){e+=t.data+(i||11)}).click().trigger("click",17).off("click"),equal(e,54,"direct event bindings with data"),e=0,jQuery("#onandoff").on("click","em",5,function(t,i){e+=t.data+(i||9)}).one("click","em",7,function(t,i){e+=t.data+(i||11)}).find("em").click().trigger("click",17).end().off("click","em"),equal(e,54,"delegated event bindings with data"),e=0,t=function(t,i){e+=(t.data||0)+(i||1)},jQuery("#onandoff").on("click clack cluck","em",2,t).on("cluck","b",7,t).on("cluck",t).trigger("what!").each(function(){equal(e,0,"nothing triggered yet")}).find("em").one("cluck",3,t).trigger("cluck",8).off().trigger("cluck",9).end().each(function(){equal(e,49,"after triggering em element")}).off("cluck",function(){}).trigger("cluck",2).each(function(){equal(e,51,"after triggering #onandoff cluck")}).find("b").on("click",95,t).on("clack","p",97,t).one("cluck",3,t).trigger("quack",19).off("click clack cluck").end().each(function(){equal(e,51,"after triggering b")}).trigger("cluck",3).off("clack","em",t).find("em").trigger("clack").end().each(function(){equal(e,54,"final triggers")}).off("click cluck");var n=jQuery.data[jQuery("#onandoff")[0].expando]||{};equal(n.events,void 0,"no events left"),i.remove()}),test("special bind/delegate name mapping",function(){expect(7),jQuery.event.special.slap={bindType:"click",delegateType:"swing",handle:function(e){equal(e.handleObj.origType,"slap","slapped your mammy, "+e.type)}};var e=function(e){ok(!0,"event "+e.type+" triggered")};jQuery('<div><button id="mammy">Are We Not Men?</button></div>').on("slap","button",jQuery.noop).on("swing","button",e).find("button").on("slap",jQuery.noop).on("click",e).trigger("click").off("slap").trigger("click").off("click").trigger("swing").end().off("slap swing","button").find("button").trigger("slap").trigger("click").trigger("swing").end().remove(),delete jQuery.event.special.slap,jQuery.event.special.gutfeeling={bindType:"click",delegateType:"click",handle:function(e){return equal(e.handleObj.origType,"gutfeeling","got a gutfeeling"),e.handleObj.handler.call(this,e)}},jQuery("<p>Gut Feeling</p>").on("click",jQuery.noop).on("gutfeeling",jQuery.noop).off("click").trigger("gutfeeling").remove(),jQuery("<p>Gut Feeling</p>").on("gutfeeling.Devo",jQuery.noop).off(".Devo").trigger("gutfeeling").remove(),jQuery("<p>Gut Feeling</p>").one("gutfeeling",jQuery.noop).trigger("gutfeeling").trigger("gutfeeling").remove(),delete jQuery.event.special.gutfeeling}),test(".on and .off, selective mixed removal (#10705)",function(){expect(7);var e=function(e){ok(!0,"triggered "+e.type)};jQuery("<p>Strange Pursuit</p>").on("click",e).on("click.duty",e).on("click.now",e).on("devo",e).on("future",e).trigger("click").trigger("devo").off(".duty devo ").trigger("future").trigger("click").off("future click").trigger("click")}),test(".on( event-map, null-selector, data ) #11130",function(){expect(1);var e=jQuery("<p>Strange Pursuit</p>"),t="bar",i={foo:function(t){equal(t.data,"bar","event.data correctly relayed with null selector"),e.remove()}};e.on(i,null,t).trigger("foo")}),test("clone() delegated events (#11076)",function(){expect(3);var e={center:0,fold:0,centerfold:0},t=function(){e[jQuery(this).text().replace(/\s+/,"")]++},i=jQuery("<table><tr><td>center</td><td>fold</td></tr></table>").on("click","tr",t).on("click","td:first-child",t).on("click","td:last-child",t),n=i.clone(!0);n.find("td").click(),equal(e.center,1,"first child"),equal(e.fold,1,"last child"),equal(e.centerfold,2,"all children"),i.remove(),n.remove()}),test("fixHooks extensions",function(){expect(2);var e=jQuery("<input type='text' id='hook-fixture' />").appendTo("body"),t=jQuery.event.fixHooks.click;e.bind("click",function(e){ok(!("blurrinessLevel"in e),"event.blurrinessLevel does not exist")}),fireNative(e[0],"click"),e.unbind("click"),jQuery.event.fixHooks.click={filter:function(e){return e.blurrinessLevel=42,e}},e.bind("click",function(e){equal(e.blurrinessLevel,42,"event.blurrinessLevel was set")}),fireNative(e[0],"click"),delete jQuery.event.fixHooks.click,e.unbind("click").remove(),jQuery.event.fixHooks.click=t}),testIframeWithCallback("jQuery.ready promise","event/promiseReady.html",function(e){expect(1),ok(e,"$.when( $.ready ) works")}),hasPHP&&testIframeWithCallback("jQuery.ready synchronous load with long loading subresources","event/syncReady.html",function(e){expect(1),ok(e,"jQuery loaded synchronously fires ready when the DOM can truly be interacted with")}),function(){function e(e){return function(t){n.push(e),r[e]=t}}var t,i,n=[],r={};t=!jQuery.isReady,test("jQuery.isReady",function(){expect(2),equal(t,!0,"jQuery.isReady should not be true before DOM ready"),equal(jQuery.isReady,!0,"jQuery.isReady should be true once DOM is ready")}),jQuery(e("a")),jQuery(document).ready(e("b")),jQuery(document).bind("ready.readytest",e("c")),jQuery(e("d")),jQuery(document).ready(e("e")),jQuery(document).bind("ready.readytest",e("f")),i=0===n.length,test("jQuery ready",function(){expect(10),ok(i,"Handlers bound to DOM ready should not execute before DOM ready"),deepEqual(n,["a","b","d","e","c","f"],"Bound DOM ready handlers should execute in bind-order, but those bound with jQuery(document).bind( 'ready', fn ) will always execute last"),equal(r.a,jQuery,"Argument passed to fn in jQuery( fn ) should be jQuery"),equal(r.b,jQuery,"Argument passed to fn in jQuery(document).ready( fn ) should be jQuery"),ok(r.c instanceof jQuery.Event,"Argument passed to fn in jQuery(document).bind( 'ready', fn ) should be an event object"),n=[],jQuery(e("g")),equal(n.pop(),"g","Event handler should execute immediately"),equal(r.g,jQuery,"Argument passed to fn in jQuery( fn ) should be jQuery"),jQuery(document).ready(e("h")),equal(n.pop(),"h","Event handler should execute immediately"),equal(r.h,jQuery,"Argument passed to fn in jQuery(document).ready( fn ) should be jQuery"),jQuery(document).bind("ready.readytest",e("never")),equal(n.length,0,"Event handler should never execute since DOM ready has already passed"),jQuery(document).unbind("ready.readytest")})}(),test("change handler should be detached from element",function(){expect(2);var e=jQuery("<input type='text' id='change-ie-leak' />").appendTo("body"),t=jQuery.removeEvent,i=function(e,i,n){equal("change",i,"Event handler for 'change' event should be removed"),equal("change-ie-leak",jQuery(e).attr("id"),"Event handler for 'change' event should be removed from appropriate element"),t(e,i,n)};jQuery.removeEvent=i,e.bind("change",function(){}),e.unbind("change"),e.remove(),jQuery.removeEvent=t}),asyncTest("trigger click on checkbox, fires change event",function(){expect(1);var e=jQuery("#check2");e.on("change",function(){e.off("change"),ok(!0,"Change event fired as a result of triggered click"),start()}).trigger("click")});